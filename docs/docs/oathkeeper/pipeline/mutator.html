<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Mutators · ORY Documentation</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="A mutator transforms the credentials from incoming requests to credentials that"/><meta name="docsearch:version" content="oryOS.17"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Mutators · ORY Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://www.ory.sh/"/><meta property="og:description" content="A mutator transforms the credentials from incoming requests to credentials that"/><meta property="og:image" content="https://www.ory.sh/images/logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://www.ory.sh/images/logo.png"/><link rel="shortcut icon" href="/images/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-71865250-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/images/logo.svg" alt="ORY Documentation"/></a><a href="/versions"><h3>oryOS.17</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/" target="_self">Home</a></li><li class=""><a href="/blog" target="_self">Blog</a></li><li class=""><a href="https://community.ory.sh" target="_self">Forum</a></li><li class=""><a href="/chat" target="_self">Chat</a></li><li class="siteNavGroupActive"><a href="/docs/" target="_self">Docs</a></li><li class=""><a href="https://github.com/ory/" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Core Concepts</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Welcome<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/">ORY Developer Documentation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Ecosystem<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/ecosystem/projects">Projects</a></li><li class="navListItem"><a class="navItem" href="/docs/ecosystem/software-architecture-philosophy">Software Architecture and Philosophy</a></li><li class="navListItem"><a class="navItem" href="/docs/ecosystem/deployment">Deployment Fundamentals and Requirements</a></li><li class="navListItem"><a class="navItem" href="/docs/ecosystem/versioning">Software Versions and Project Maturity</a></li><li class="navListItem"><a class="navItem" href="/docs/ecosystem/upgrading">Software Updates</a></li><li class="navListItem"><a class="navItem" href="/docs/ecosystem/api-design">API Design</a></li><li class="navListItem"><a class="navItem" href="/docs/ecosystem/community">Community</a></li><li class="navListItem"><a class="navItem" href="/docs/ecosystem/sqa">Software Quality Assurance</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Kratos<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Introduction</h4><ul><li class="navListItem"><a class="navItem" href="/docs/kratos/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/quickstart">Quickstart</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/install">Installation</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Concepts</h4><ul><li class="navListItem"><a class="navItem" href="/docs/kratos/concepts/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/concepts/ui-user-interface">User Interface</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/concepts/identity-user-model">Identity and User Model</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/concepts/credentials">Credentials</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/concepts/email-sms">Out-of-band communication via E-Mail and SMS</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/concepts/federation">Federation</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/concepts/security">Threat Models and Security Profiles</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Self Service Flows</h4><ul><li class="navListItem"><a class="navItem" href="/docs/kratos/self-service/flows/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/self-service/flows/user-login-user-registration">User Login and User Registration</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/self-service/flows/user-logout">User Logout</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/self-service/flows/user-profile-management">Profile Management</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/self-service/flows/password-reset-account-recovery">Account Recovery</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/self-service/flows/user-facing-errors">User-Facing Errors</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/self-service/flows/verify-email-account-activation">Email and Phone Verification and Account Activation</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Self Service Strategies</h4><ul><li class="navListItem"><a class="navItem" href="/docs/kratos/self-service/strategies/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/self-service/strategies/username-email-password">Username or Email and Password</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/self-service/strategies/openid-connect-social-sign-in-oauth2">Social Sign In with OpenID Connect and OAuth2</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Self Service Jobs and Workflows</h4><ul><li class="navListItem"><a class="navItem" href="/docs/kratos/self-service/workflows/jobs/before">Before Jobs</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/self-service/workflows/jobs/after">After Jobs</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Reference</h4><ul><li class="navListItem"><a class="navItem" href="/docs/kratos/reference/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/reference/json-schema-json-paths">JSON Schema and JSON Paths</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/reference/html-forms">HTML Form Parser</a></li><li class="navListItem"><a class="navItem" href="/docs/kratos/sdk/api">REST API</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">SDKs</h4><ul><li class="navListItem"><a class="navItem" href="/docs/kratos/sdk/">Overview</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Further Reading</h4><ul><li class="navListItem"><a class="navItem" href="/docs/kratos/further-reading/comparison">Comparison</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Hydra<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/hydra/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/install">Installation</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Concepts</h4><ul><li class="navListItem"><a class="navItem" href="/docs/hydra/oauth2">OAuth 2.0</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/login-consent-flow">Hydra workflow</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Integrating Hydra into your stack</h4><ul><li class="navListItem"><a class="navItem" href="/docs/hydra/5min-tutorial">5 Minute Tutorial</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/implementing-consent">Login, Consent &amp; Logout</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/case-study">OAuth 2.0 Case Study</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/docs/hydra/configure-deploy">Installation and Setup</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/dependencies-environment">Database Setup and Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/production">Preparing for Production</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/debugging">Debugging</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/advanced">Advanced Topics</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/integration">Consuming OAuth 2.0</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">API &amp; SDKs</h4><ul><li class="navListItem"><a class="navItem" href="/docs/hydra/sdk/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/sdk/api">REST API</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/sdk/go">Go</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/sdk/js">JavaScript</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/sdk/php">PHP</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Further Reading</h4><ul><li class="navListItem"><a class="navItem" href="/docs/hydra/limitations">Limitations</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/jwks">JSON Web Key Sets</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/security-architecture">Security Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/hydra/faq">FAQ</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Oathkeeper<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/oathkeeper/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/oathkeeper/install">Installation</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Core Concepts</h4><ul><li class="navListItem"><a class="navItem" href="/docs/oathkeeper/api-access-rules">API Access Rules</a></li><li class="navListItem"><a class="navItem" href="/docs/oathkeeper/pipeline/authn">Authenticators</a></li><li class="navListItem"><a class="navItem" href="/docs/oathkeeper/pipeline/authz">Authorizers</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/oathkeeper/pipeline/mutator">Mutators</a></li><li class="navListItem"><a class="navItem" href="/docs/oathkeeper/pipeline/error">Error Handlers</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/docs/oathkeeper/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/oathkeeper/configure-deploy">Configure and Deploy</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">API &amp; SDKs</h4><ul><li class="navListItem"><a class="navItem" href="/docs/oathkeeper/sdk/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/oathkeeper/sdk/api">REST API</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Keto<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/keto/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/keto/install">Installation</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/docs/keto/configure-deploy">Configure and Deploy</a></li><li class="navListItem"><a class="navItem" href="/docs/keto/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/keto/secure">Secure</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Control Engines</h4><ul><li class="navListItem"><a class="navItem" href="/docs/keto/engines/">Access Control Engines - Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/keto/engines/acl">Access Control Lists (ACL)</a></li><li class="navListItem"><a class="navItem" href="/docs/keto/engines/rbac">Role Based Access Control (RBAC)</a></li><li class="navListItem"><a class="navItem" href="/docs/keto/engines/acp-ory">ORY Access Control Policies</a></li><li class="navListItem"><a class="navItem" href="/docs/keto/engines/acp-aws">AWS IAM Policies</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">API &amp; SDKs</h4><ul><li class="navListItem"><a class="navItem" href="/docs/keto/sdk/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/keto/sdk/api">REST API</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Performance<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/performance/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/performance/hydra">ORY Hydra</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/ory/docs/edit/master/docs/oathkeeper/pipeline/mutator.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Mutators</h1></header><article><div><span><p>A mutator transforms the credentials from incoming requests to credentials that
your backend understands. For example, the <code>Authorization: basic</code> header might
be transformed to <code>X-User: &lt;subject-id&gt;</code>. This allows you to write backends that
do not care if the original request was an anonymous one, an OAuth 2.0 Access
Token, or some other credential type. All your backend has to do is understand,
for example, the <code>X-User:</code>.</p>
<p>The Access Control Decision API will return the mutated result as the HTTP
Response.</p>
<h2><a class="anchor" aria-hidden="true" id="noop"></a><a href="#noop" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>noop</code></h2>
<p>This mutator does not transform the HTTP request and simply forwards the headers
as-is. This is useful if you don't want to replace, for example,
<code>Authorization: basic</code> with <code>X-User: &lt;subject-id&gt;</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="configuration"></a><a href="#configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h3>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># Global configuration file oathkeeper.yml</span>
<span class="hljs-attr">mutators:</span>
  <span class="hljs-attr">noop:</span>
    <span class="hljs-comment"># Set enabled to true if the authenticator should be enabled and false to disable the authenticator. Defaults to false.</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
</code></pre>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># Some Access Rule: access-rule-1.yaml</span>
<span class="hljs-attr">id:</span> <span class="hljs-string">access-rule-1</span>
<span class="hljs-comment"># match: ...</span>
<span class="hljs-comment"># upstream: ...</span>
<span class="hljs-attr">mutators:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">handler:</span> <span class="hljs-string">noop</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="access-rule-example"></a><a href="#access-rule-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Access Rule Example</h3>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> cat ./rules.json</span>
{
  "id": "some-id",
  "upstream": {
    "url": "http://my-backend-service"
  },
  "match": {
    "url": "http://my-app/api/users/&lt;[0-9]+&gt;/&lt;[a-zA-Z]+&gt;",
    "methods": [
      "GET"
    ]
  },
  "authenticators": [
    {
      "handler": "anonymous"
    }
  ],
  "authorizer": {
    "handler": "allow"
  },
  "mutators": [
    {
      "handler": "noop"
    }
  ]
}
<span class="hljs-meta">
$</span><span class="bash"> curl -X GET http://my-app/some-route</span>

HTTP/1.0 200 Status OK
The request has been allowed! The original HTTP Request has not been modified.
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="id_token"></a><a href="#id_token" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>id_token</code></h2>
<p>This mutator takes the authentication information (e.g. subject) and transforms
it to a signed JSON Web Token, and more specifically to an OpenID Connect ID
Token. Your backend can verify the token by fetching the (public) key from the
<code>/.well-known/jwks.json</code> endpoint provided by the ORY Oathkeeper API.</p>
<p>Let's say a request is made to a resource protected by ORY Oathkeeper using
Basic Authorization:</p>
<pre><code class="hljs"><span class="hljs-builtin-name">GET</span> /api<span class="hljs-built_in">/resource </span>HTTP/1.1
Host: www.example.com
Authorization: Basic <span class="hljs-attribute">Zm9vOmJhcg</span>==
</code></pre>
<p>Assuming that ORY Oathkeeper is granting the access request,
<code>Basic Zm9vOmJhcg==</code> will be replaced with a cryptographically signed JSON Web
Token:</p>
<pre><code class="hljs"><span class="hljs-builtin-name">GET</span> /api<span class="hljs-built_in">/resource </span>HTTP/1.1
Host: internal-api-endpoint-dns
Authorization: Bearer &lt;jwt-signed-id-token&gt;
</code></pre>
<p>Now, the protected resource is capable of decoding and validating the JSON Web
Token using the public key supplied by ORY Oathkeeper's API. The public key for
decoding the ID token is available at ORY Oathkeeper's <code>/.well-known/jwks.json</code>
endpoint:</p>
<pre><code class="hljs">http:<span class="hljs-regexp">//</span>oathkeeper:<span class="hljs-number">4456</span><span class="hljs-regexp">/.well-known/</span>jwks.json
</code></pre>
<p>The related flow diagram looks like this:</p>
<p><a href="https://mermaidjs.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gICAgcGFydGljaXBhbnQgQyBhcyBDbGllbnRcbiAgICBwYXJ0aWNpcGFudCBPIGFzIE9hdGhrZWVwZXIgUHJveHlcbiAgICBwYXJ0aWNpcGFudCBBIGFzIFByb3RlY3RlZCBTZXJ2ZXIvQVBJXG4gICAgQy0-Pk86IEF1dGhvcml6YXRpb246IEJhc2ljIC4uLi5cbiAgICBPLS0-Pk86IFZhbGlkYXRlIGNyZWRlbnRpYWxzXG4gICAgTy0-PkE6IEF1dGhvcml6YXRpb246IEJlYXJlciBKLlcuVFxuICAgIEEtLT4-TzogRmV0Y2ggUHVibGljIEtleVxuICAgIEEtLT4-QTogVmFsaWRhdGUgSldUIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQiLCJ0aGVtZUNTUyI6Ii5sYWJlbCBmb3JlaWduT2JqZWN0IHsgb3ZlcmZsb3c6IHZpc2libGU7IGZvbnQtc2l6ZTogMTNweCB9In19">
<img alt="ID Token Transformation" src="/images/docs/oathkeeper/id_token.svg">
<a/></p>
<p>Let's say the <code>oauth2_client_credentials</code> authenticator successfully
authenticated the credentials <code>client-id:client-secret</code>. This mutator will craft
an ID Token (JWT) with the following exemplary claims:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"iss"</span>: <span class="hljs-string">"https://server.example.com"</span>,
  <span class="hljs-attr">"sub"</span>: <span class="hljs-string">"client-id"</span>,
  <span class="hljs-attr">"aud"</span>: <span class="hljs-string">"s6BhdRkqt3"</span>,
  <span class="hljs-attr">"jti"</span>: <span class="hljs-string">"n-0S6_WzA2Mj"</span>,
  <span class="hljs-attr">"exp"</span>: <span class="hljs-number">1311281970</span>,
  <span class="hljs-attr">"iat"</span>: <span class="hljs-number">1311280970</span>
}
</code></pre>
<p>The ID Token Claims are as follows:</p>
<ul>
<li><code>iss</code>: Issuer Identifier for the Issuer of the response. The iss value is a
case sensitive URL using the https scheme that contains scheme, host, and
optionally, port number and path components and no query or fragment
components. Typically, this is the URL of ORY Oathkeeper, for example:
<code>https://oathkeeper.myapi.com</code>.</li>
<li><code>sub</code>: Subject Identifier. A locally unique and never reassigned identifier
within the Issuer for the End-User, which is intended to be consumed by the
Client, e.g., 24400320 or AItOawmwtWwcT0k51BayewNvutrJUqsvl6qs7A4. It must not
exceed 255 ASCII characters in length. The sub value is a case sensitive
string. The End-User might also be an OAuth 2.0 Client, given that the access
token was granted using the OAuth 2.0 Client Credentials flow.</li>
<li><code>aud</code>: Audience(s) that this ID Token is intended for. It MUST contain the
OAuth 2.0 client_id of the Relying Party as an audience value. It MAY also
contain identifiers for other audiences. In the general case, the aud value is
an array of case sensitive strings.</li>
<li><code>exp</code>: Expiration time on or after which the ID Token MUST NOT be accepted for
processing. The processing of this parameter requires that the current
date/time MUST be before the expiration date/time listed in the value. Its
value is a JSON number representing the number of seconds from
1970-01-01T0:0:0Z as measured in UTC until the date/time. See RFC 3339
[RFC3339] for details regarding date/times in general and UTC in particular.</li>
<li><code>iat</code>: Time at which the JWT was issued. Its value is a JSON number
representing the number of seconds from 1970-01-01T0:0:0Z as measured in UTC
until the date/time.</li>
<li><code>jti</code>: A cryptographically strong random identifier to ensure the ID Token's
uniqueness.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="global-configuration"></a><a href="#global-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Global Configuration</h3>
<h3><a class="anchor" aria-hidden="true" id="configuration-1"></a><a href="#configuration-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h3>
<ul>
<li><code>issuer_url</code> (string, required) - Sets the &quot;iss&quot; value of the ID Token.</li>
<li><code>jwks_url</code> (string, required) - Sets the URL where keys should be fetched
from. Supports remote locations (http, https) as well as local filesystem
paths.</li>
<li><code>ttl</code> (string, optional) - Sets the time-to-live of the ID token. Defaults to
one minute. Valid time units are: s (second), m (minute), h (hour).</li>
<li><code>claims</code> (string, optional) - Allows you to customize the ID Token claims and
support Go Templates. For more information, check section <a href="#claims">Claims</a></li>
</ul>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># Global configuration file oathkeeper.yml</span>
<span class="hljs-attr">mutators:</span>
  <span class="hljs-attr">id_token:</span>
    <span class="hljs-comment"># Set enabled to true if the authenticator should be enabled and false to disable the authenticator. Defaults to false.</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">issuer_url:</span> <span class="hljs-string">https://my-oathkeeper/</span>
      <span class="hljs-attr">jwks_url:</span> <span class="hljs-string">https://fetch-keys/from/this/location.json</span>
      <span class="hljs-comment"># jwks_url: file:///from/this/absolute/location.json</span>
      <span class="hljs-comment"># jwks_url: file://../from/this/relative/location.json</span>
      <span class="hljs-attr">ttl:</span> <span class="hljs-string">60s</span>
      <span class="hljs-attr">claims:</span>
        <span class="hljs-string">'{"aud": ["https://my-backend-service/some/endpoint"],"def": "<span class="hljs-template-variable">{{ print
        .Extra.some.arbitrary.data }}</span>"}'</span>
</code></pre>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># Some Access Rule: access-rule-1.yaml</span>
<span class="hljs-attr">id:</span> <span class="hljs-string">access-rule-1</span>
<span class="hljs-comment"># match: ...</span>
<span class="hljs-comment"># upstream: ...</span>
<span class="hljs-attr">mutators:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">handler:</span> <span class="hljs-string">id_token</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">issuer_url:</span> <span class="hljs-string">https://my-oathkeeper/</span>
      <span class="hljs-attr">jwks_url:</span> <span class="hljs-string">https://fetch-keys/from/this/location.json</span>
      <span class="hljs-comment"># jwks_url: file:///from/this/absolute/location.json</span>
      <span class="hljs-comment"># jwks_url: file://../from/this/relative/location.json</span>
      <span class="hljs-attr">ttl:</span> <span class="hljs-string">60s</span>
      <span class="hljs-attr">claims:</span>
        <span class="hljs-string">'{"aud": ["https://my-backend-service/some/endpoint"],"def": "<span class="hljs-template-variable">{{ print
        .Extra.some.arbitrary.data }}</span>"}'</span>
</code></pre>
<p>The first private key found in the JSON Web Key Set defined by
<code>mutators.id_token.jwks_url</code> will be used for signing the JWT:</p>
<ul>
<li>If the first key found is a symmetric key (<code>HS256</code> algorithm), that key will
be used. That key <strong>will not</strong> be broadcasted at <code>/.well-known/jwks.json</code>. You
must manually configure the upstream to be able to fetch the key (e.g. from an
environment variable).</li>
<li>If the first key found is an asymmetric private key (e.g. <code>RS256</code>, <code>ES256</code>,
...), that key will be used. The related public key will be broadcasted at
<code>/.well-known/jwks.json</code>.</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="claims"></a><a href="#claims" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Claims</h4>
<p>This mutator allows you to specify custom claims, like the audience of ID
tokens, via the <code>claims</code> field of the mutator's <code>config</code> field. The keys
represent names of claims and the values are arbitrary data structures which
will be parsed by the Go <a href="https://golang.org/pkg/text/template/">text/template</a>
package for value substitution, receiving the
<a href="https://github.com/ory/oathkeeper/blob/92c09fb28552949cd034ed5555c87dfda91407a3/proxy/authenticator.go#L19">AuthenticationSession</a>
struct:</p>
<pre><code class="hljs css language-go"><span class="hljs-keyword">type</span> AuthenticationSession <span class="hljs-keyword">struct</span> {
    Subject <span class="hljs-keyword">string</span>
    Extra   <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>{}
    Header  http.Header
}
</code></pre>
<p>Note that the <code>AuthenticationSession</code> struct has a field named <code>Extra</code> which is
a <code>map[string]interface{}</code>, which receives varying introspection data from the
authentication process. Because the contents of <code>Extra</code> are so variable, nested
and potentially non-existent values need special handling by the <code>text/template</code>
parser, and a <code>print</code> FuncMap function has been provided to ensure that
non-existent map values will simply return an empty string, rather than
<code>&lt;no value&gt;</code>.</p>
<p>If you find that your claims contain the string <code>&lt;no value&gt;</code> then you have most
likely omitted the <code>print</code> function, and it is recommended you use it for all
values out of an abundance of caution and for consistency.</p>
<p>The claims configuration expects a string which is expected to be valid JSON.
The string can contain <a href="https://golang.org/pkg/text/template/">Golang Template</a>
instructions allowing you to programmatically generate the claims string:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"id_token"</span>,
  <span class="hljs-attr">"config"</span>: {
    <span class="hljs-attr">"claims"</span>: <span class="hljs-string">"{\"aud\": [\"https://my-backend-service/some/endpoint\"],\"def\": \"{{ print .Extra.some.arbitrary.data }}\"}"</span>
  }
}
</code></pre>
<p>This also supports <a href="http://masterminds.github.io/sprig/">sprig</a> template helpers
for more advanced functionality.</p>
<p>Please keep in mind that certain keys (such as the <code>sub</code>) claim <strong>can not</strong> be
overwritten!</p>
<h3><a class="anchor" aria-hidden="true" id="access-rule-example-1"></a><a href="#access-rule-example-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Access Rule Example</h3>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> cat ./rules.json</span>
{
  "id": "some-id",
  "upstream": {
    "url": "http://my-backend-service"
  },
  "match": {
    "url": "http://my-app/api/users/&lt;[0-9]+&gt;/&lt;[a-zA-Z]+&gt;",
    "methods": [
      "GET"
    ]
  },
  "authenticators": [
    {
      "handler": "anonymous"
    }
  ],
  "authorizer": {
    "handler": "allow"
  },
  "mutators": [
    {
      "handler": "id_token",
      "config": {
        "aud": [
          "audience-1",
          "audience-2"
        ],
        "claims": "{\"abc\": \"{{ print .Subject }}\",\"def\": \"{{ print .Extra.some.arbitrary.data }}\"}"
      }
    }
  ]
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="header"></a><a href="#header" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>header</code></h2>
<p>This mutator will transform the request, allowing you to pass the credentials to
the upstream application via the headers. This will augment, for example,
<code>Authorization: basic</code> with <code>X-User: &lt;subject-id&gt;</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="configuration-2"></a><a href="#configuration-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h3>
<ul>
<li><code>headers</code> (object (<code>string: string</code>), required) - A keyed object
(<code>string:string</code>) representing the headers to be added to this request, see
section <a href="#headers">headers</a>.</li>
</ul>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># Global configuration file oathkeeper.yml</span>
<span class="hljs-attr">mutators:</span>
  <span class="hljs-attr">header:</span>
    <span class="hljs-comment"># Set enabled to true if the authenticator should be enabled and false to disable the authenticator. Defaults to false.</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">headers:</span>
        <span class="hljs-attr">X-User:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ print .Subject }}</span>"</span><span class="hljs-string">,</span>
        <span class="hljs-attr">X-Some-Arbitrary-Data:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ print .Extra.some.arbitrary.data }}</span>"</span>
</code></pre>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># Some Access Rule: access-rule-1.yaml</span>
<span class="hljs-attr">id:</span> <span class="hljs-string">access-rule-1</span>
<span class="hljs-comment"># match: ...</span>
<span class="hljs-comment"># upstream: ...</span>
<span class="hljs-attr">mutators:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">handler:</span> <span class="hljs-string">header</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">headers:</span>
        <span class="hljs-attr">X-User:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ print .Subject }}</span>"</span><span class="hljs-string">,</span>
        <span class="hljs-attr">X-Some-Arbitrary-Data:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ print .Extra.some.arbitrary.data }}</span>"</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="headers"></a><a href="#headers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Headers</h4>
<p>The headers are specified via the <code>headers</code> field of the mutator's <code>config</code>
field. The keys are the header name and the values are a string which will be
parsed by the Go <a href="https://golang.org/pkg/text/template/"><code>text/template</code></a>
package for value substitution, receiving the
<a href="https://github.com/ory/oathkeeper/blob/d21179dd25543662075be402f6e24e1ee20d2754/pipeline/authn/authenticator.go#L26"><code>AuthenticationSession</code></a>
struct:</p>
<pre><code class="hljs css language-go"><span class="hljs-keyword">type</span> AuthenticationSession <span class="hljs-keyword">struct</span> {
    Subject <span class="hljs-keyword">string</span>
    Extra   <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>{}
    Header  http.Header
}
</code></pre>
<p>Note that the <code>AuthenticationSession</code> struct has a field named <code>Extra</code> which is
a <code>map[string]interface{}</code>, which receives varying introspection data from the
authentication process. Because the contents of <code>Extra</code> are so variable, nested
and potentially non-existent values need special handling by the <code>text/template</code>
parser, and a <code>print</code> FuncMap function has been provided to ensure that
non-existent map values will simply return an empty string, rather than
<code>&lt;no value&gt;</code>.</p>
<p>If you find that your headers contain the string <code>&lt;no value&gt;</code> then you have most
likely omitted the <code>print</code> function, and it is recommended you use it for all
values out of an abundance of caution and for consistency.</p>
<h3><a class="anchor" aria-hidden="true" id="access-rule-example-2"></a><a href="#access-rule-example-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Access Rule Example</h3>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"some-id"</span>,
  <span class="hljs-attr">"upstream"</span>: {
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://my-backend-service"</span>
  },
  <span class="hljs-attr">"match"</span>: {
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://my-app/api/&lt;.*&gt;"</span>,
    <span class="hljs-attr">"methods"</span>: [<span class="hljs-string">"GET"</span>]
  },
  <span class="hljs-attr">"authenticators"</span>: [
    {
      <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"anonymous"</span>
    }
  ],
  <span class="hljs-attr">"authorizer"</span>: {
    <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"allow"</span>
  },
  <span class="hljs-attr">"mutators"</span>: [
    {
      <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"header"</span>,
      <span class="hljs-attr">"config"</span>: {
        <span class="hljs-attr">"headers"</span>: {
          <span class="hljs-attr">"X-User"</span>: <span class="hljs-string">"{{ print .Subject }}"</span>,
          <span class="hljs-attr">"X-Some-Arbitrary-Data"</span>: <span class="hljs-string">"{{ print .Extra.some.arbitrary.data }}"</span>
        }
      }
    }
  ]
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="cookie"></a><a href="#cookie" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>cookie</code></h2>
<p>This mutator will transform the request, allowing you to pass the credentials to
the upstream application via the cookies.</p>
<h3><a class="anchor" aria-hidden="true" id="configuration-3"></a><a href="#configuration-3" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h3>
<ul>
<li><code>cookies</code> (object (<code>string: string</code>), required) - A keyed object
(<code>string:string</code>) representing the cookies to be added to this request, see
section <a href="#cookies">cookies</a>.</li>
</ul>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># Global configuration file oathkeeper.yml</span>
<span class="hljs-attr">mutators:</span>
  <span class="hljs-attr">cookie:</span>
    <span class="hljs-comment"># Set enabled to true if the authenticator should be enabled and false to disable the authenticator. Defaults to false.</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">cookies:</span>
        <span class="hljs-attr">user:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ print .Subject }}</span>"</span><span class="hljs-string">,</span>
        <span class="hljs-attr">some-arbitrary-data:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ print .Extra.some.arbitrary.data }}</span>"</span>
</code></pre>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># Some Access Rule: access-rule-1.yaml</span>
<span class="hljs-attr">id:</span> <span class="hljs-string">access-rule-1</span>
<span class="hljs-comment"># match: ...</span>
<span class="hljs-comment"># upstream: ...</span>
<span class="hljs-attr">mutators:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">handler:</span> <span class="hljs-string">cookie</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">cookies:</span>
        <span class="hljs-attr">user:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ print .Subject }}</span>"</span><span class="hljs-string">,</span>
        <span class="hljs-attr">some-arbitrary-data:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ print .Extra.some.arbitrary.data }}</span>"</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="cookies"></a><a href="#cookies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cookies</h3>
<p>The cookies are specified via the <code>cookies</code> field of the mutators <code>config</code>
field. The keys are the cookie name and the values are a string which will be
parsed by the Go <a href="https://golang.org/pkg/text/template/"><code>text/template</code></a>
package for value substitution, receiving the
<a href="https://github.com/ory/oathkeeper/blob/d21179dd25543662075be402f6e24e1ee20d2754/pipeline/authn/authenticator.go#L26">AuthenticationSession</a>
struct:</p>
<pre><code class="hljs css language-go"><span class="hljs-keyword">type</span> AuthenticationSession <span class="hljs-keyword">struct</span> {
    Subject <span class="hljs-keyword">string</span>
    Extra   <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>{}
    Header  http.Header
}
</code></pre>
<p>Note that the <code>AuthenticationSession</code> struct has a field named <code>Extra</code> which is
a <code>map[string]interface{}</code>, which receives varying introspection data from the
authentication process. Because the contents of <code>Extra</code> are so variable, nested
and potentially non-existent values need special handling by the <code>text/template</code>
parser, and a <code>print</code> FuncMap function has been provided to ensure that
non-existent map values will simply return an empty string, rather than
<code>&lt;no value&gt;</code>.</p>
<p>If you find that your cookies contain the string <code>&lt;no value&gt;</code> then you have most
likely omitted the <code>print</code> function, and it is recommended you use it for all
values out of an abundance of caution and for consistency.</p>
<h5><a class="anchor" aria-hidden="true" id="example"></a><a href="#example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h5>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"some-id"</span>,
  <span class="hljs-attr">"upstream"</span>: {
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://my-backend-service"</span>
  },
  <span class="hljs-attr">"match"</span>: {
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://my-app/api/&lt;.*&gt;"</span>,
    <span class="hljs-attr">"methods"</span>: [<span class="hljs-string">"GET"</span>]
  },
  <span class="hljs-attr">"authenticators"</span>: [
    {
      <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"anonymous"</span>
    }
  ],
  <span class="hljs-attr">"authorizer"</span>: {
    <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"allow"</span>
  },
  <span class="hljs-attr">"mutators"</span>: [
    {
      <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"cookie"</span>,
      <span class="hljs-attr">"config"</span>: {
        <span class="hljs-attr">"cookies"</span>: {
          <span class="hljs-attr">"user"</span>: <span class="hljs-string">"{{ print .Subject }}"</span>,
          <span class="hljs-attr">"some-arbitrary-data"</span>: <span class="hljs-string">"{{ print .Extra.some.arbitrary.data }}"</span>
        }
      }
    }
  ]
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="hydrator"></a><a href="#hydrator" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>hydrator</code></h2>
<p>This mutator allows for fetching additional data from external APIs, which can
be then used by other mutators. It works by making an upstream HTTP call to an
API specified in the <strong>Per-Rule Configuration</strong> section below. The request is a
POST request and it contains JSON representation of
<a href="https://github.com/ory/oathkeeper/blob/d21179dd25543662075be402f6e24e1ee20d2754/pipeline/authn/authenticator.go#L26">AuthenticationSession</a>
struct in body, which is:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: String,
  <span class="hljs-attr">"extra"</span>: Object,
  <span class="hljs-attr">"header"</span>: Object
}
</code></pre>
<p>As a response the mutator expects similiar JSON object, but with <code>extra</code> or
<code>header</code> fields modified.</p>
<p>Example request/response payload:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"anonymous"</span>,
  <span class="hljs-attr">"extra"</span>: {
    <span class="hljs-attr">"foo"</span>: <span class="hljs-string">"bar"</span>
  },
  <span class="hljs-attr">"header"</span>: {
    <span class="hljs-attr">"foo"</span>: [<span class="hljs-string">"bar1"</span>, <span class="hljs-string">"bar2"</span>]
  }
}
</code></pre>
<p>The AuthenticationSession from this object replaces the original one and is
passed to the next mutator, where it can be used to e.g. set a particular cookie
to the value received from an API.</p>
<p>Setting <code>extra</code> field does not transform the HTTP request, whereas headers set
in the <code>header</code> field will be added to the final request headers.</p>
<h3><a class="anchor" aria-hidden="true" id="configuration-4"></a><a href="#configuration-4" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h3>
<ul>
<li><code>api.url</code> (string - required) - The API URL.</li>
<li><code>api.auth.basic.*</code> (optional) - Enables HTTP Basic Authorization.</li>
<li><code>api.auth.retry.*</code> (optional) - Configures the retry logic.</li>
</ul>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># Global configuration file oathkeeper.yml</span>
<span class="hljs-attr">mutators:</span>
  <span class="hljs-attr">hydrator:</span>
    <span class="hljs-comment"># Set enabled to true if the authenticator should be enabled and false to disable the authenticator. Defaults to false.</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">api:</span>
        <span class="hljs-attr">url:</span> <span class="hljs-string">http://my-backend-api</span>
        <span class="hljs-attr">auth:</span>
          <span class="hljs-attr">basic:</span>
            <span class="hljs-attr">username:</span> <span class="hljs-string">someUserName</span>
            <span class="hljs-attr">password:</span> <span class="hljs-string">somePassword</span>
        <span class="hljs-attr">retry:</span>
          <span class="hljs-attr">give_up_after:</span> <span class="hljs-string">2s</span>
          <span class="hljs-attr">max_delay:</span> <span class="hljs-string">100ms</span>
</code></pre>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># Some Access Rule: access-rule-1.yaml</span>
<span class="hljs-attr">id:</span> <span class="hljs-string">access-rule-1</span>
<span class="hljs-comment"># match: ...</span>
<span class="hljs-comment"># upstream: ...</span>
<span class="hljs-attr">mutators:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">handler:</span> <span class="hljs-string">hydrator</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">api:</span>
        <span class="hljs-attr">url:</span> <span class="hljs-string">http://my-backend-api</span>
        <span class="hljs-attr">auth:</span>
          <span class="hljs-attr">basic:</span>
            <span class="hljs-attr">username:</span> <span class="hljs-string">someUserName</span>
            <span class="hljs-attr">password:</span> <span class="hljs-string">somePassword</span>
        <span class="hljs-attr">retry:</span>
          <span class="hljs-attr">give_up_after:</span> <span class="hljs-string">2s</span>
          <span class="hljs-attr">max_delay:</span> <span class="hljs-string">100ms</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="access-rule-example-3"></a><a href="#access-rule-example-3" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Access Rule Example</h3>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"some-id"</span>,
  <span class="hljs-attr">"upstream"</span>: {
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://my-backend-service"</span>
  },
  <span class="hljs-attr">"match"</span>: {
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://my-app/api/&lt;.*&gt;"</span>,
    <span class="hljs-attr">"methods"</span>: [<span class="hljs-string">"GET"</span>]
  },
  <span class="hljs-attr">"authenticators"</span>: [
    {
      <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"anonymous"</span>
    }
  ],
  <span class="hljs-attr">"authorizer"</span>: {
    <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"allow"</span>
  },
  <span class="hljs-attr">"mutators"</span>: [
    {
      <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"hydrator"</span>,
      <span class="hljs-attr">"config"</span>: {
        <span class="hljs-attr">"api"</span>: {
          <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://my-backend-api"</span>
        }
      }
    },
    {
      <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"cookie"</span>,
      <span class="hljs-attr">"config"</span>: {
        <span class="hljs-attr">"cookies"</span>: {
          <span class="hljs-attr">"some-arbitrary-data"</span>: <span class="hljs-string">"{{ print .Extra.cookie }}"</span>
        }
      }
    }
  ]
}
</code></pre>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 12/16/2019 by hackerman</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/oathkeeper/pipeline/authz"><span class="arrow-prev">← </span><span>Authorizers</span></a><a class="docs-next button" href="/docs/oathkeeper/pipeline/error"><span>Error Handlers</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#noop"><code>noop</code></a><ul class="toc-headings"><li><a href="#configuration">Configuration</a></li><li><a href="#access-rule-example">Access Rule Example</a></li></ul></li><li><a href="#id_token"><code>id_token</code></a><ul class="toc-headings"><li><a href="#global-configuration">Global Configuration</a></li><li><a href="#configuration-1">Configuration</a></li><li><a href="#access-rule-example-1">Access Rule Example</a></li></ul></li><li><a href="#header"><code>header</code></a><ul class="toc-headings"><li><a href="#configuration-2">Configuration</a></li><li><a href="#access-rule-example-2">Access Rule Example</a></li></ul></li><li><a href="#cookie"><code>cookie</code></a><ul class="toc-headings"><li><a href="#configuration-3">Configuration</a></li><li><a href="#cookies">Cookies</a></li></ul></li><li><a href="#hydrator"><code>hydrator</code></a><ul class="toc-headings"><li><a href="#configuration-4">Configuration</a></li><li><a href="#access-rule-example-3">Access Rule Example</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2020 ORY GmbH</section><div id="codefund"></div><script src="https://codefund.io/properties/140/funder.js" async=""></script><script>(function () {
  document.querySelectorAll('.tabs .tabs-nav .nav-item a').forEach(function (t) {
    t.addEventListener("click", function (e) {
      e.preventDefault();

      t.closest('.tabs-nav').querySelectorAll('.nav-item a').forEach(function (i) {
        i.classList.remove('active');
      });

      t.closest('.tabs').querySelectorAll('.tab-content .tab-pane').forEach(function (i) {
        i.classList.remove('active');
      });

      t.classList.add('active');
      document.getElementById(t.href.split('#')[1]).classList.add('active');
      return false
    });
  });
})();</script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '8463c6ece843b377565726bb4ed325b0',
                indexName: 'ory',
                inputSelector: '#search_input_react'
              });
            </script></body></html>