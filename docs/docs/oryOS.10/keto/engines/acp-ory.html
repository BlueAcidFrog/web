<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>ORY Access Control Policies · ORY Documentation</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="At ORY, we use an Access Control Policy DSL modeled after AWS IAM Policies."/><meta name="docsearch:version" content="oryOS.10"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="ORY Access Control Policies · ORY Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://www.ory.sh/"/><meta property="og:description" content="At ORY, we use an Access Control Policy DSL modeled after AWS IAM Policies."/><meta property="og:image" content="https://www.ory.sh/images/logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://www.ory.sh/images/logo.png"/><link rel="shortcut icon" href="/images/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-71865250-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/images/logo.svg" alt="ORY Documentation"/></a><a href="/versions"><h3>oryOS.10</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/" target="_self">Home</a></li><li class=""><a href="/blog" target="_self">Blog</a></li><li class=""><a href="https://community.ory.sh" target="_self">Forum</a></li><li class=""><a href="/chat" target="_self">Chat</a></li><li class="siteNavGroupActive"><a href="/docs/oryOS.10/" target="_self">Docs</a></li><li class=""><a href="https://github.com/ory/" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Access Control Engines</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Welcome<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/">ORY Developer Documentation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Ecosystem<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/ecosystem/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/ecosystem/cloud-native">Cloud Native Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/ecosystem/versioning">Software Versions</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/ecosystem/upgrading">Software Updates</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/ecosystem/examples">Learn By Example</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/ecosystem/community">Community</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/ecosystem/sqa">Software Quality Assurance</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Hydra<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/">Introduction</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Getting Started</h4><ul><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/5min-tutorial">5 Minute Tutorial</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/oauth2">Integrating with (existing) User Management</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/configure-deploy">Installation and Setup</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/dependencies-environment">Database Setup and Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/production">Preparing for Production</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/debugging">Debugging</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/advanced">Advanced Topics</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/integration">Consuming OAuth 2.0</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">SDK</h4><ul><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/sdk/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/sdk/api">REST API</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/sdk/go">Go</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/sdk/js">JavaScript</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Further Reading</h4><ul><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/limitations">Limitations</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/jwks">JSON Web Key Sets</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/security-architecture">Security Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/hydra/faq">FAQ</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Oathkeeper<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/oathkeeper/">Introduction</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/oathkeeper/api-access-rules">API Access Rules</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/oathkeeper/configure-deploy">Configure and Deploy</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/oathkeeper/control-flow">Control Flow</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">SDK</h4><ul><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/oathkeeper/sdk/api">REST API</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Keto<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/keto/">Introduction</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/keto/install">Install</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/keto/configure-deploy">Configure and Deploy</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/keto/secure">Secure</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Control Engines</h4><ul><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/keto/engines/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/keto/engines/acl">Access Control Lists (ACL)</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/keto/engines/rbac">Role Based Access Control (RBAC)</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/oryOS.10/keto/engines/acp-ory">ORY Access Control Policies</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/keto/engines/acp-aws">AWS IAM Policies</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">SDK</h4><ul><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/keto/sdk/api">REST API</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Performance<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/performance/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/oryOS.10/performance/hydra">ORY Hydra</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/ory/docs/edit/master/docs/keto/engines/acp-ory.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">ORY Access Control Policies</h1></header><article><div><span><p>At ORY, we use an Access Control Policy DSL modeled after AWS IAM Policies.
These policies define an <code>effect</code>, <code>subject</code>, <code>action</code>, and <code>resource</code>. For
example, <code>alice</code> (subject aka identity aka user) is <code>allowed</code> (effect) to
<code>delete</code> (action) blog article with ID <code>my-first-blog-post</code> (<code>resource</code>). This
is very similar to how ACLs work:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"alice"</span>],
  <span class="hljs-attr">"resources"</span>: [<span class="hljs-string">"blog_posts:my-first-blog-post"</span>],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"delete"</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"allow"</span>
}
</code></pre>
<p>The policy above allows <code>alice</code> to <code>delete</code> <code>blog_posts:my-first-blog-post</code>. We
could apply this policy to more subjects and also more actions or resources, if
we want to:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"alice"</span>, <span class="hljs-string">"bob"</span>],
  <span class="hljs-attr">"resources"</span>: [
    <span class="hljs-string">"blog_posts:my-first-blog-post"</span>,
    <span class="hljs-string">"blog_posts:2"</span>,
    <span class="hljs-string">"blog_posts:3"</span>
  ],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"delete"</span>, <span class="hljs-string">"create"</span>, <span class="hljs-string">"read"</span>, <span class="hljs-string">"modify"</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"allow"</span>
}
</code></pre>
<p>Well, this looks like ACL in disguise so far. So what's different?</p>
<h2><a class="anchor" aria-hidden="true" id="precedence"></a><a href="#precedence" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Precedence</h2>
<p>The first difference is that we can explicitly deny access:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"peter"</span>],
  <span class="hljs-attr">"resources"</span>: [
    <span class="hljs-string">"blog_posts:my-first-blog-post"</span>,
    <span class="hljs-string">"blog_posts:2"</span>,
    <span class="hljs-string">"blog_posts:3"</span>
  ],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"delete"</span>, <span class="hljs-string">"create"</span>, <span class="hljs-string">"read"</span>, <span class="hljs-string">"modify"</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"deny"</span>
}
</code></pre>
<p>The policy decision point (the one checking if something is allowed or not)
applies the following rule set when deciding if something is allowed or not:</p>
<ol>
<li>If at least one policy for a given subject, action, and resource matches, and
the effect is <code>deny</code>, the request is always denied.</li>
<li>If no policy matches with effect <code>deny</code>, but at least one policy with effect
<code>allow</code>, the request is allowed.</li>
<li>If no policy matches at all, the request is denied.</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="pattern-matching-strategies"></a><a href="#pattern-matching-strategies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pattern Matching Strategies</h2>
<p>ORY Keto has implements several ORY ACP pattern matching strategies.</p>
<h3><a class="anchor" aria-hidden="true" id="case-sensitive-equality"></a><a href="#case-sensitive-equality" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Case Sensitive Equality</h3>
<p>The easiest pattern matching strategy is the case sensitive equality check. This
strategy simply checks if two strings are exactly the same. Assuming a policy
defines <code>{&quot;subjects&quot;: [&quot;alice&quot;, &quot;boB&quot;] }</code>, then it will match exactly subjects
<code>alice</code> and <code>boB</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="glob-pattern-matching"></a><a href="#glob-pattern-matching" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Glob Pattern Matching</h3>
<p>ORY Keto supports matching URNs with glob pattern matching. Policy</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"users:*"</span>],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"get"</span>, <span class="hljs-string">"create"</span>],
  <span class="hljs-attr">"resources"</span>: [<span class="hljs-string">"resources:articles:*"</span>, <span class="hljs-string">"resources:{accounts,profiles}:*"</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"allow"</span>
}
</code></pre>
<p>for example will match the following inputs:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"users:maria"</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"get"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"resources:profiles:foo"</span>
}
</code></pre>
<p>The <code>:</code> is always understood as a delimiter. The following syntax is supported
by this strategy:</p>
<ul>
<li>Single symbol wildcard <code>?at</code> matches <code>cat</code> and <code>bat</code> but not <code>at</code>.</li>
<li>Wildcard <code>foo:*:bar</code> matches <code>foo:baz:bar</code> and <code>foo:zab:bar</code> but not <code>foo:bar</code>
nor <code>foo:baz:baz:bar</code></li>
<li>Super wildcard <code>foo:**:bar</code> matches <code>foo:baz:baz:bar</code>, <code>foo:baz:bar</code>, and
<code>foo:bar</code>, but not <code>foobar</code> or <code>foo:baz</code></li>
<li>Character list <code>[cb]at</code> matches <code>cat</code> and <code>bat</code> but not <code>mat</code> nor <code>at</code>.</li>
<li>Negated character list <code>[!cb]at</code> matches <code>tat</code> and <code>mat</code> but not <code>cat</code> nor
<code>bat</code>.</li>
<li>Ranged character list <code>[a-c]at</code> <code>cat</code> and <code>bat</code> but not <code>mat</code> nor <code>at</code>.</li>
<li>Negated ranged character list <code>[!a-c]at</code> matches <code>mat</code> and <code>tat</code> but not <code>cat</code>
nor <code>bat</code>.</li>
<li>Alternatives list <code>{cat,bat,[mt]at}</code> matches <code>cat</code>, <code>bat</code>, <code>mat</code>, <code>tat</code> but
nothing else.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="regular-expressions"></a><a href="#regular-expressions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Regular Expressions</h3>
<p>ORY Keto allows you to apply pattern matching with regular expressions as well.
Depending on how you name your subjects, resources, and actions (for more on
that topic go to the <a href="#best-practices">Best Practices</a> section), you can apply
pattern matching using regular expressions.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"users:&lt;.*&gt;"</span>]
}
</code></pre>
<p>In the example above, the (incomplete) policy would match every subject that is
prefixed with <code>users:</code>, so for example <code>users:alice</code>, <code>users:bob</code>. In ORY Ladon
/ ORY Keto, regular expressions are delimited with <code>&lt;</code> and <code>&gt;</code>. For example,
<code>&quot;users:.*&quot;</code> is not a valid regular expression, just a simple string.</p>
<p>The next example will allow all subjects with prefix <code>user:</code> to read
(<code>actions:read</code>) all resources that match <code>resources:blog_posts:&lt;[0-9]+&gt;</code> (e.g.
<code>resources:blog_posts:1234</code> but not <code>resources:blog_posts:abcde</code>):</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"users:&lt;.*&gt;"</span>],
  <span class="hljs-attr">"resources"</span>: [<span class="hljs-string">"resources:blog_posts:&lt;[0-9]+&gt;"</span>],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"actions:read"</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"allow"</span>
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="computational-overhead"></a><a href="#computational-overhead" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Computational Overhead</h3>
<p>Different pattern matching strategies have different computational complexity,
considering performance when choosing an approach is important:</p>
<ul>
<li>Case Sensitive Equality: No computational overhead.</li>
<li>Glob Pattern Matching: Little computational overhead.</li>
<li>Regex: Considerable computational overhead.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="conditions"></a><a href="#conditions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conditions</h2>
<p>Conditions are another powerful concept. So far, we covered that an ORY ACP
applies to a list of <code>subjects</code>, <code>resources</code>, and <code>actions</code>. Conditions narrow
down the use cases in which a certain ACP applies. A condition may, for example,
mandate that the IP Address of the client making the request has to match e.g.
<code>192.168.0.0/16</code> or that the subject is also the owner of the resource:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"One policy to rule them all."</span>,
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"users:maria"</span>],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"delete"</span>, <span class="hljs-string">"create"</span>, <span class="hljs-string">"update"</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"allow"</span>,
  <span class="hljs-attr">"resources"</span>: [<span class="hljs-string">"resources:articles:&lt;.*&gt;"</span>],
  <span class="hljs-attr">"conditions"</span>: {
    <span class="hljs-attr">"remoteIPAddress"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CIDRCondition"</span>,
      <span class="hljs-attr">"options"</span>: {
        <span class="hljs-attr">"cidr"</span>: <span class="hljs-string">"192.168.0.0/16"</span>
      }
    }
  }
}
</code></pre>
<p>Conditions are defined in policies. Context is defined when asking if someone is
allowed to do something (access control). Conditions use contexts and decide if
a policy is responsible for handling the access request at hand.</p>
<p>Conditions are functions returning true or false given a context. Because
conditions implement logic, they must be programmed. ORY Keto provides several
conditions out of the box, which can be improved or extended at any time.</p>
<p>A condition has always the same JSON format:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"..."</span>],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"..."</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"allow"</span>,
  <span class="hljs-attr">"resources"</span>: [<span class="hljs-string">"..."</span>],
  <span class="hljs-attr">"conditions"</span>: {
    <span class="hljs-attr">"this-key-will-be-matched-with-the-context"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"SomeConditionType"</span>,
      <span class="hljs-attr">"options"</span>: {
        <span class="hljs-attr">"some"</span>: <span class="hljs-string">"configuration options set by the condition type"</span>
      }
    }
  }
}
</code></pre>
<p>The context in the access request made to the ORY ACP Allowed API must match the
specified key in the condition in order to be evaluated by the condition logic:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"..."</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"..."</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"..."</span>,
  <span class="hljs-attr">"context"</span>: {
    <span class="hljs-attr">"this-key-will-be-matched-with-the-context"</span>: { <span class="hljs-attr">"foo"</span>: <span class="hljs-string">"bar"</span> }
  }
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="cidr-condition"></a><a href="#cidr-condition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CIDR Condition</h3>
<p>The CIDR condition matches CIDR IP Ranges. An exemplary policy definition could
look as follows.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"One policy to rule them all."</span>,
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"users:maria"</span>],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"delete"</span>, <span class="hljs-string">"create"</span>, <span class="hljs-string">"update"</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"allow"</span>,
  <span class="hljs-attr">"resources"</span>: [<span class="hljs-string">"resources:articles:&lt;.*&gt;"</span>],
  <span class="hljs-attr">"conditions"</span>: {
    <span class="hljs-attr">"remoteIPAddress"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CIDRCondition"</span>,
      <span class="hljs-attr">"options"</span>: {
        <span class="hljs-attr">"cidr"</span>: <span class="hljs-string">"192.168.0.0/16"</span>
      }
    }
  }
}
</code></pre>
<p>The following access request would be allowed.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"users:maria"</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"delete"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"resources:articles:12345"</span>,
  <span class="hljs-attr">"context"</span>: {
    <span class="hljs-attr">"remoteIPAddress"</span>: <span class="hljs-string">"192.168.0.5"</span>
  }
}
</code></pre>
<p>The next access request would be denied as the condition is not fulfilled and
thus no policy is matched.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"users:maria"</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"delete"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"resources:articles:12345"</span>,
  <span class="hljs-attr">"context"</span>: {
    <span class="hljs-attr">"remoteIPAddress"</span>: <span class="hljs-string">"255.255.0.0"</span>
  }
}
</code></pre>
<p>The next access request would also be denied as the context is not using the key
<code>remoteIPAddress</code> but instead <code>someOtherKey</code>.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"users:maria"</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"delete"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"resources:articles:12345"</span>,
  <span class="hljs-attr">"context"</span>: {
    <span class="hljs-attr">"someOtherKey"</span>: <span class="hljs-string">"192.168.0.5"</span>
  }
}
</code></pre>
<h5><a class="anchor" aria-hidden="true" id="string-equal-condition"></a><a href="#string-equal-condition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>String Equal Condition</h5>
<p>Checks if the value passed in the access request's context is identical with the
string that was given initially.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"One policy to rule them all."</span>,
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"users:maria"</span>],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"delete"</span>, <span class="hljs-string">"create"</span>, <span class="hljs-string">"update"</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"allow"</span>,
  <span class="hljs-attr">"resources"</span>: [<span class="hljs-string">"resources:articles:&lt;.*&gt;"</span>],
  <span class="hljs-attr">"conditions"</span>: {
    <span class="hljs-attr">"someKeyName"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"StringEqualCondition"</span>,
      <span class="hljs-attr">"options"</span>: {
        <span class="hljs-attr">"equals"</span>: <span class="hljs-string">"the-value-should-be-this"</span>
      }
    }
  }
}
</code></pre>
<p>The following access request would be allowed.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"users:maria"</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"delete"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"resources:articles:12345"</span>,
  <span class="hljs-attr">"context"</span>: {
    <span class="hljs-attr">"someKeyName"</span>: <span class="hljs-string">"the-value-should-be-this"</span>
  }
}
</code></pre>
<p>The following access request would be denied.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"users:maria"</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"delete"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"resources:articles:12345"</span>,
  <span class="hljs-attr">"context"</span>: {
    <span class="hljs-attr">"someKeyName"</span>: <span class="hljs-string">"this-is-a-different-value"</span>
  }
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="string-match-condition"></a><a href="#string-match-condition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>String Match Condition</h3>
<p>Checks if the value passed in the access request's context matches the regular
expression that was given initially.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"One policy to rule them all."</span>,
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"users:maria"</span>],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"delete"</span>, <span class="hljs-string">"create"</span>, <span class="hljs-string">"update"</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"allow"</span>,
  <span class="hljs-attr">"resources"</span>: [<span class="hljs-string">"resources:articles:&lt;.*&gt;"</span>],
  <span class="hljs-attr">"conditions"</span>: {
    <span class="hljs-attr">"someKeyName"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"StringMatchCondition"</span>,
      <span class="hljs-attr">"options"</span>: {
        <span class="hljs-attr">"matches"</span>: <span class="hljs-string">"regex-pattern-here.+"</span>
      }
    }
  }
}
</code></pre>
<p>The following access request would be allowed.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"users:maria"</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"delete"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"resources:articles:12345"</span>,
  <span class="hljs-attr">"context"</span>: {
    <span class="hljs-attr">"someKeyName"</span>: <span class="hljs-string">"regex-pattern-here-matches"</span>
  }
}
</code></pre>
<p>The following access request would be denied.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"users:maria"</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"delete"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"resources:articles:12345"</span>,
  <span class="hljs-attr">"context"</span>: {
    <span class="hljs-attr">"someKeyName"</span>: <span class="hljs-string">"regex-pattern-here"</span>
  }
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="subject-condition"></a><a href="#subject-condition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subject Condition</h3>
<p>Checks if the access request's subject is identical with the string specified in
the context.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"One policy to rule them all."</span>,
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"users:maria"</span>],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"delete"</span>, <span class="hljs-string">"create"</span>, <span class="hljs-string">"update"</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"allow"</span>,
  <span class="hljs-attr">"resources"</span>: [<span class="hljs-string">"resources:articles:&lt;.*&gt;"</span>],
  <span class="hljs-attr">"conditions"</span>: {
    <span class="hljs-attr">"owner"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"EqualsSubjectCondition"</span>,
      <span class="hljs-attr">"options"</span>: {}
    }
  }
}
</code></pre>
<p>The following access request would be allowed.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"users:maria"</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"delete"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"resources:articles:12345"</span>,
  <span class="hljs-attr">"context"</span>: {
    <span class="hljs-attr">"owner"</span>: <span class="hljs-string">"users:maria"</span>
  }
}
</code></pre>
<p>The following access request would be denied.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"users:maria"</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"delete"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"resources:articles:12345"</span>,
  <span class="hljs-attr">"context"</span>: {
    <span class="hljs-attr">"owner"</span>: <span class="hljs-string">"another-user"</span>
  }
}
</code></pre>
<p>This condition makes more sense when being used with access tokens where the
subject is extracted from the token.</p>
<h3><a class="anchor" aria-hidden="true" id="string-pairs-equal-condition"></a><a href="#string-pairs-equal-condition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>String Pairs Equal Condition</h3>
<p>Checks if the value passed in the access request's context contains two-element
arrays and that both elements in each pair are equal.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"One policy to rule them all."</span>,
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"users:maria"</span>],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"delete"</span>, <span class="hljs-string">"create"</span>, <span class="hljs-string">"update"</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"allow"</span>,
  <span class="hljs-attr">"resources"</span>: [<span class="hljs-string">"resources:articles:&lt;.*&gt;"</span>],
  <span class="hljs-attr">"conditions"</span>: {
    <span class="hljs-attr">"someKey"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"StringPairsEqualCondition"</span>,
      <span class="hljs-attr">"options"</span>: {}
    }
  }
}
</code></pre>
<p>The following access request would be allowed.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"users:maria"</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"delete"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"resources:articles:12345"</span>,
  <span class="hljs-attr">"context"</span>: {
    <span class="hljs-attr">"someKey"</span>: [
      [<span class="hljs-string">"some-arbitrary-pair-value"</span>, <span class="hljs-string">"some-arbitrary-pair-value"</span>],
      [<span class="hljs-string">"some-other-arbitrary-pair-value"</span>, <span class="hljs-string">"some-other-arbitrary-pair-value"</span>]
    ]
  }
}
</code></pre>
<p>The following access request would be denied.</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"users:maria"</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"delete"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"resources:articles:12345"</span>,
  <span class="hljs-attr">"context"</span>: {
    <span class="hljs-attr">"someKey"</span>: [
      [<span class="hljs-string">"some-arbitrary-pair-value"</span>, <span class="hljs-string">"some-other-arbitrary-pair-value"</span>]
    ]
  }
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="roles"></a><a href="#roles" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Roles</h2>
<p>ORY ACPs support a role concept, similar to RBAC. This feature allows you to
group together a number of subjects under the same role. Whenever making a
request to the Allowed API, it will check the roles of a subject (if there are
any) and use them when looking up the <code>subjects</code> field.</p>
<p>Assuming the following policies:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"bob"</span>],
  <span class="hljs-attr">"resources"</span>: [<span class="hljs-string">"blog_posts:my-first-blog-post"</span>],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"create"</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"allow"</span>
}
</code></pre>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"subjects"</span>: [<span class="hljs-string">"admin"</span>],
  <span class="hljs-attr">"resources"</span>: [<span class="hljs-string">"blog_posts:my-first-blog-post"</span>],
  <span class="hljs-attr">"actions"</span>: [<span class="hljs-string">"delete"</span>],
  <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"allow"</span>
}
</code></pre>
<p>As you can see, <code>bob</code> is allowed to create resource
<code>blog_posts:my-first-blog-post</code> and <code>admin</code> is allowed to delete it. Making the
following request to the Allowed API</p>
<pre><code class="hljs">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"bob"</span>,
  <span class="hljs-attr">"action"</span> : <span class="hljs-string">"delete"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"blog_posts:my-first-blog-post"</span>
}
</code></pre>
<p>will return <code>{ &quot;allowed&quot;: false }</code> while this request</p>
<pre><code class="hljs">{
  <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"admin"</span>,
  <span class="hljs-attr">"action"</span> : <span class="hljs-string">"delete"</span>,
  <span class="hljs-attr">"resource"</span>: <span class="hljs-string">"blog_posts:my-first-blog-post"</span>
}
</code></pre>
<p>will return <code>{ &quot;allowed&quot;: true }</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="implementation-status"></a><a href="#implementation-status" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implementation Status</h2>
<p>ORY Access Control Policies (regex, glob, equality) are first-class citizens.</p>
<h2><a class="anchor" aria-hidden="true" id="best-practices"></a><a href="#best-practices" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Best Practices</h2>
<p>This sections gives an overview of best practices for access control policies we
developed over the years at ORY.</p>
<h3><a class="anchor" aria-hidden="true" id="urns"></a><a href="#urns" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>URNs</h3>
<blockquote>
<p>“There are only two hard things in Computer Science: cache invalidation and
naming things.” -- Phil Karlton</p>
</blockquote>
<p>URN naming is as hard as naming API endpoints. Thankfully, by doing the latter,
the former is usually solved as well. We will explore further best practices in
the following sections.</p>
<h3><a class="anchor" aria-hidden="true" id="scope-the-organization-name"></a><a href="#scope-the-organization-name" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scope the Organization Name</h3>
<p>A rule of thumb is to prefix resource names with a domain that represents the
organization creating the software.</p>
<ul>
<li><strong>Do not:</strong> <code>&lt;some-id&gt;</code></li>
<li><strong>Do:</strong> <code>&lt;organizaion-id&gt;:&lt;some-id&gt;</code></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="scope-actions-resources-and-subjects"></a><a href="#scope-actions-resources-and-subjects" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scope Actions, Resources and Subjects</h3>
<p>It is wise to scope actions, resources, and subjects in order to prevent name
collisions:</p>
<ul>
<li><strong>Do not:</strong> <code>myorg.com:&lt;subject-id&gt;</code>, <code>myorg.com:&lt;resource-id&gt;</code>,
<code>myorg.com:&lt;action-id&gt;</code></li>
<li><strong>Do:</strong> <code>myorg.com:subjects:&lt;subject-id&gt;</code>,
<code>myorg.com:resources:&lt;resource-id&gt;</code>, <code>myorg.com:actions:&lt;action-id&gt;</code></li>
<li><strong>Do:</strong> <code>subjects:myorg.com:&lt;subject-id&gt;</code>,
<code>resources:myorg.com:&lt;resource-id&gt;</code>, <code>actions:myorg.com:&lt;action-id&gt;</code></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="multi-tenant-systems"></a><a href="#multi-tenant-systems" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Multi-Tenant Systems</h3>
<p>Multi-tenant systems typically have resources which should not be access by
other tenants in the system. This can be achieved by adding the tenant id to the
URN:</p>
<ul>
<li><strong>Do:</strong> <code>resources:myorg.com:tenants:&lt;tenant-id&gt;:&lt;resource-id&gt;</code></li>
</ul>
<p>In some environments, it is common to have organizations and projects belonging
to those organizations. Here, the following URN semantics can be used:</p>
<ul>
<li><strong>Do:</strong>
<code>resources:myorg.com:organizations:&lt;organization-id&gt;:projects:&lt;project-id&gt;:&lt;resource-id&gt;</code></li>
</ul>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 5/17/2019 by hackerman</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/oryOS.10/keto/engines/rbac"><span class="arrow-prev">← </span><span>Role Based Access Control (RBAC)</span></a><a class="docs-next button" href="/docs/oryOS.10/keto/engines/acp-aws"><span>AWS IAM Policies</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#precedence">Precedence</a></li><li><a href="#pattern-matching-strategies">Pattern Matching Strategies</a><ul class="toc-headings"><li><a href="#case-sensitive-equality">Case Sensitive Equality</a></li><li><a href="#glob-pattern-matching">Glob Pattern Matching</a></li><li><a href="#regular-expressions">Regular Expressions</a></li><li><a href="#computational-overhead">Computational Overhead</a></li></ul></li><li><a href="#conditions">Conditions</a><ul class="toc-headings"><li><a href="#cidr-condition">CIDR Condition</a></li><li><a href="#string-match-condition">String Match Condition</a></li><li><a href="#subject-condition">Subject Condition</a></li><li><a href="#string-pairs-equal-condition">String Pairs Equal Condition</a></li></ul></li><li><a href="#roles">Roles</a></li><li><a href="#implementation-status">Implementation Status</a></li><li><a href="#best-practices">Best Practices</a><ul class="toc-headings"><li><a href="#urns">URNs</a></li><li><a href="#scope-the-organization-name">Scope the Organization Name</a></li><li><a href="#scope-actions-resources-and-subjects">Scope Actions, Resources and Subjects</a></li><li><a href="#multi-tenant-systems">Multi-Tenant Systems</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2020 ORY GmbH</section><div id="codefund"></div><script src="https://codefund.io/properties/140/funder.js" async=""></script><script>(function () {
  document.querySelectorAll('.tabs .tabs-nav .nav-item a').forEach(function (t) {
    t.addEventListener("click", function (e) {
      e.preventDefault();

      t.closest('.tabs-nav').querySelectorAll('.nav-item a').forEach(function (i) {
        i.classList.remove('active');
      });

      t.closest('.tabs').querySelectorAll('.tab-content .tab-pane').forEach(function (i) {
        i.classList.remove('active');
      });

      t.classList.add('active');
      document.getElementById(t.href.split('#')[1]).classList.add('active');
      return false
    });
  });
})();</script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '8463c6ece843b377565726bb4ed325b0',
                indexName: 'ory',
                inputSelector: '#search_input_react'
              });
            </script></body></html>