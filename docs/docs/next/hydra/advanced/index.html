<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Advanced Topics · ORY Documentation</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="This guide aims to help setting up a production system with ORY Hydra."/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Advanced Topics · ORY Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://www.ory.sh/"/><meta property="og:description" content="This guide aims to help setting up a production system with ORY Hydra."/><meta property="og:image" content="https://www.ory.sh/images/logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://www.ory.sh/images/logo.png"/><link rel="shortcut icon" href="/images/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-71865250-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/images/logo.svg" alt="ORY Documentation"/></a><a href="/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/" target="_self">Home</a></li><li class=""><a href="/blog" target="_self">Blog</a></li><li class=""><a href="https://community.ory.sh" target="_self">Forum</a></li><li class=""><a href="/chat" target="_self">Chat</a></li><li class="siteNavGroupActive"><a href="/docs/next/" target="_self">Docs</a></li><li class=""><a href="https://github.com/ory/" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Welcome<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/">ORY Developer Documentation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Ecosystem<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/projects">Projects</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/software-architecture-philosophy">Software Architecture and Philosophy</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/deployment">Deployment Fundamentals and Requirements</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/versioning">Software Versions and Project Maturity</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/upgrading">Software Updates</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/api-design">API Design</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/community">Community</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/sqa">Software Quality Assurance</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Kratos<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Introduction</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/quickstart">Quickstart</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/install">Installation</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Concepts</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/ui-user-interface">User Interface</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/identity-user-model">Identity and User Model</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/credentials">Credentials</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/email-sms">Out-of-band communication via E-Mail and SMS</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/federation">Federation</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/security">Threat Models and Security Profiles</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Self Service Flows</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/flows/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/flows/user-login-user-registration">User Login and User Registration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/flows/user-logout">User Logout</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/flows/user-profile-management">Profile Management</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/flows/password-reset-account-recovery">Account Recovery</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/flows/user-facing-errors">User-Facing Errors</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Self Service Strategies</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/strategies/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/strategies/username-email-password">Username or Email and Password</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/strategies/openid-connect-social-sign-in-oauth2">Social Sign In with OpenID Connect and OAuth2</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Self Service Jobs and Workflows</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/workflows/jobs/before">Before Jobs</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/workflows/jobs/after">After Jobs</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Reference</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/reference/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/reference/json-schema-json-paths">JSON Schema and JSON Paths</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/reference/html-forms">HTML Form Parser</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/sdk/api">REST API</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">SDKs</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/sdk/">Overview</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Further Reading</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/further-reading/comparison">Comparison</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Hydra<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/hydra/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/install">Installation</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Concepts</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/hydra/oauth2">OAuth 2.0</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/login-consent-flow">Hydra workflow</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Integrating Hydra into your stack</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/hydra/5min-tutorial">5 Minute Tutorial</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/implementing-consent">Login, Consent &amp; Logout</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/case-study">OAuth 2.0 Case Study</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/hydra/configure-deploy">Installation and Setup</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/dependencies-environment">Database Setup and Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/production">Preparing for Production</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/debugging">Debugging</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/next/hydra/advanced">Advanced Topics</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/integration">Consuming OAuth 2.0</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">API &amp; SDKs</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/hydra/sdk/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/sdk/api">REST API</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/sdk/go">Go</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/sdk/js">JavaScript</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/sdk/php">PHP</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Further Reading</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/hydra/limitations">Limitations</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/jwks">JSON Web Key Sets</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/security-architecture">Security Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/faq">FAQ</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Oathkeeper<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/install">Installation</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Core Concepts</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/api-access-rules">API Access Rules</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/pipeline/authn">Authenticators</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/pipeline/authz">Authorizers</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/pipeline/mutator">Mutators</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/pipeline/error">Error Handlers</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/configure-deploy">Configure and Deploy</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">API &amp; SDKs</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/sdk/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/sdk/api">REST API</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Keto<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/keto/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/install">Installation</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/keto/configure-deploy">Configure and Deploy</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/secure">Secure</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Control Engines</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/keto/engines/">Access Control Engines - Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/engines/acl">Access Control Lists (ACL)</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/engines/rbac">Role Based Access Control (RBAC)</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/engines/acp-ory">ORY Access Control Policies</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/engines/acp-aws">AWS IAM Policies</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">API &amp; SDKs</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/keto/sdk/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/sdk/api">REST API</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Performance<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/performance/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/next/performance/hydra">ORY Hydra</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/ory/docs/edit/master/docs/hydra/advanced.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Advanced Topics</h1></header><article><div><span><p>This guide aims to help setting up a production system with ORY Hydra.</p>
<!-- toc -->
<h2><a class="anchor" aria-hidden="true" id="mobile--browser-spa-authorization"></a><a href="#mobile--browser-spa-authorization" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mobile &amp; Browser (SPA) Authorization</h2>
<p>We have an
<a href="https://www.ory.sh/oauth2-for-mobile-app-spa-browser">excellent blog post</a> on
this topic. Read it now!</p>
<h3><a class="anchor" aria-hidden="true" id="creating-a-public-oauth-20-client"></a><a href="#creating-a-public-oauth-20-client" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating a public OAuth 2.0 Client</h3>
<p>You can create a public OAuth 2.0 Client (e.g. for the authorize code + PKCE or
implicit flow) with the CLI</p>
<pre><code class="hljs">hydra clients create <span class="hljs-params">--endpoint</span> http:<span class="hljs-string">//ory-hydra-admin-api</span> <span class="hljs-params">--token-endpoint-auth-method</span> none
</code></pre>
<p>or by setting in the HTTP API JSON body when POSTing to <code>/clients</code>:</p>
<pre><code class="hljs">{
    <span class="hljs-attr">"client_id"</span>: <span class="hljs-string">"..."</span>,
    <span class="hljs-attr">"token_endpoint_auth_method"</span>: <span class="hljs-string">"none"</span>
}
</code></pre>
<p>Be aware that when making requests to <code>/oauth2/token</code> with a public OAuth 2.0
Client, you can not authenticate with the HTTP Basic Authorization but must
include the <code>client_id</code> in the POST body.</p>
<h2><a class="anchor" aria-hidden="true" id="key-rotation"></a><a href="#key-rotation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Key rotation</h2>
<p>There are two types of key rotation:</p>
<ul>
<li>Rotation of JSON Web Token Signing Keys</li>
<li>Rotation of HMAC Token Signing and Database and Cookie Encryption Keys</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="rotation-of-json-web-token-signing-keys"></a><a href="#rotation-of-json-web-token-signing-keys" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rotation of JSON Web Token Signing Keys</h3>
<p>JSON Web Token Signing Key rotation is simple with ORY Hydra. You can rotate
OpenID Connect ID Token and OAuth 2.0 Access Tokens, when using the JSON Web
Token strategy, keys with one simple command.</p>
<p>ORY Hydra takes the latest key from the key store to sign JSON Web Tokens. All
public keys will be shown at
<code>http://ory-hydra-public-api/.well-known/jwks.json</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="openid-connect-id-token"></a><a href="#openid-connect-id-token" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OpenID Connect ID Token</h4>
<pre><code class="hljs">hydra <span class="hljs-built_in">keys</span> <span class="hljs-built_in">create</span> <span class="hljs-comment">--endpoint=http://ory-hydra-admin-api/ hydra.openid.id-token -a RS256</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="oauth-20-access-tokens-json-web-token"></a><a href="#oauth-20-access-tokens-json-web-token" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OAuth 2.0 Access Tokens (JSON Web Token)</h4>
<blockquote>
<p>This will only work when using the JWT access token strategy. Otherwise, this
will have no effect.</p>
</blockquote>
<pre><code class="hljs">hydra <span class="hljs-built_in">keys</span> <span class="hljs-built_in">create</span> <span class="hljs-comment">--endpoint=http://ory-hydra-admin-api/ hydra.jwt.access-token -a RS256</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="rotation-of-hmac-token-signing-and-database-and-cookie-encryption-keys"></a><a href="#rotation-of-hmac-token-signing-and-database-and-cookie-encryption-keys" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rotation of HMAC Token Signing and Database and Cookie Encryption Keys</h3>
<p>Rotating database encryption keys is done by prepending the new encryption key
to the respective configuration value. Assuming configuration</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">secrets:</span>
  <span class="hljs-attr">cookie:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">the-old-cookie-encryption-key</span>
  <span class="hljs-attr">system:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">the-old-system-encryption-key</span>
</code></pre>
<p>one would add the new keys as follows</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">secrets:</span>
  <span class="hljs-attr">cookie:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">the-new-cookie-encryption-key</span> <span class="hljs-comment"># the new key must be the first entry</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">the-old-cookie-encryption-key</span>
  <span class="hljs-attr">system:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">the-new-system-encryption-key</span> <span class="hljs-comment"># the new key must be the first entry</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">the-old-system-encryption-key</span>
</code></pre>
<blockquote>
<p>It is very important that the new key is the first entry in the list as only
the first key is used for encryption while all keys from the list are used for
decryption. Please note that existing data will not be automatically
re-encrypted using the new key. Only new data will be signed and encrypted
using the new key. It is therefore imperative that the old key is added to the
list, unless you want to also invalidate all data that was signed or encrypted
using the old key.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="oauth-20"></a><a href="#oauth-20" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OAuth 2.0</h2>
<h3><a class="anchor" aria-hidden="true" id="audience"></a><a href="#audience" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Audience</h3>
<p>There are two types of audience concept in the context of OAuth 2.0 and OpenID
Connect:</p>
<ol>
<li>OAuth 2.0: Access and Refresh Tokens are &quot;internal-facing&quot;. The <code>aud</code> claim
of an OAuth 2.0 Access and Refresh token defines at which <em>endpoints</em> the
token can be used.</li>
<li>OpenID Connect: The ID Token is &quot;external-facing&quot;. The <code>aud</code> claim of an
OpenID Connect ID Token defines which <em>clients</em> should accept it.</li>
</ol>
<p>While modifying the audience of an ID Token is not desirable, specifying the
audience of an OAuth 2.0 Access Token is. This is not defined as an IETF
Standard but is considered good practice in certain environments.</p>
<p>For this reason, Hydra allows you to control the aud claim of the access token.
To do so, you must specify the intended audiences in the OAuth 2.0 Client's
metadata on a per-client basis:</p>
<pre><code class="hljs">{
    <span class="hljs-attr">"client_id"</span>: <span class="hljs-string">"..."</span>,
    <span class="hljs-attr">"audience"</span>: [<span class="hljs-string">"https://api.my-cloud.com/user"</span>, <span class="hljs-string">"https://some-tenant.my-cloud.com/"</span>]
}
</code></pre>
<p>The audience is a list of case-sensitive URLs. <strong>URLs must not contain
whitespaces</strong>.</p>
<h4><a class="anchor" aria-hidden="true" id="oauth-20-authorization-code-implicit-hybrid-flows"></a><a href="#oauth-20-authorization-code-implicit-hybrid-flows" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OAuth 2.0 Authorization Code, Implicit, Hybrid Flows</h4>
<p>When performing an OAuth 2.0 authorize code, implicit, or hybrid flow, you can
request audiences at the <code>/oauth2/auth</code> endpoint
<code>https://my-hydra.com/oauth2/auth?client_id=...&amp;scope=...&amp;audience=https%3A%2F%2Fapi.my-cloud.com%2Fuser+https%3A%2F%2Fsome-tenant.my-cloud.com%2F</code>
which requests audiences <code>https://api.my-cloud.com/user</code> and
<code>https://some-tenant.my-cloud.com/</code>.</p>
<p>The <code>audience</code> query parameter may contain multiple strings separated by a
url-encoded space (<code>+</code> or <code>%20</code>). The audience values themselves must also be
url encoded. The values will be validated against the whitelisted audiences
defined in the OAuth 2.0 Client:</p>
<ul>
<li>An OAuth 2.0 Client with the allowed audience <code>https://api.my-cloud/user</code> is
allowed to request audience values <code>https://api.my-cloud/user</code>
<code>https://api.my-cloud/user/1234</code> but not <code>https://api.my-cloud/not-user</code> nor
<code>https://something-else/</code>.</li>
</ul>
<p>The requested audience from the query parameter is then part of the login and
consent request payload as field <code>requested_access_token_audience</code>. You can then
alter the audience using <code>grant_audience.access_token</code> when accepting the
consent request:</p>
<pre><code class="hljs"><span class="hljs-selector-tag">hydra</span><span class="hljs-selector-class">.acceptConsentRequest</span>(challenge, {
  <span class="hljs-comment">// ORY Hydra checks if requested audiences are allowed by the client, so we can simply echo this.</span>
  <span class="hljs-attribute">grant_audience</span>: {
    <span class="hljs-attribute">access_token</span>: response.requested_access_token_audience,
    <span class="hljs-comment">// or, for example:</span>
    <span class="hljs-comment">// access_token: ["https://api.my-cloud/not-user"]</span>
  },

  <span class="hljs-comment">// ... remember: false</span>
  <span class="hljs-comment">// ...</span>
})
</code></pre>
<p>When introspecting the OAuth 2.0 Access Token, the response payload will include
the audience:</p>
<pre><code class="hljs">{
  <span class="hljs-attr">"active"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">"audience"</span>: [<span class="hljs-string">"https://api.my-cloud/user"</span>, <span class="hljs-string">"https://api.my-cloud/user/1234"</span>]
}
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="oauth-20-client-credentials-grant"></a><a href="#oauth-20-client-credentials-grant" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OAuth 2.0 Client Credentials Grant</h4>
<p>When performing the client credentials grant, the audience parameter from the
POST body of the <code>/oauth2/token</code> is decoded and validated according to the same
rules of the previous section, except for the login and consent part which does
not exist for this flow.</p>
<h3><a class="anchor" aria-hidden="true" id="json-web-tokens"></a><a href="#json-web-tokens" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JSON Web Tokens</h3>
<p>ORY Hydra issues opaque OAuth 2.0 Access Tokens per default for the following
reasons:</p>
<ol>
<li><strong>OAuth 2.0 Access Tokens represent internal state but are public
knowledge:</strong> An Access Token often contains internal data (e.g. session data)
or other sensitive data (e.g. user roles and permissions) and is sometimes
used as a means of transporting system-relevant information in a stateless
manner. Therefore, making these tokens transparent (by using JSON Web Tokens
as Access Tokens) comes with risk of exposing this information accidentally,
and with the downside of not storing this information in the OAuth 2.0 Access
Token at all.</li>
<li><strong>JSON Web Tokens can not hold secrets:</strong> Unless encrypted, JSON Web Tokens
can be read by everyone, including 3rd Parties. Therefore, they can not keep
secrets. This point is similar to (1), but it is important to stress this.</li>
<li><strong>Access Tokens as JSON Web Tokens can not be revoked:</strong> Well, you can revoke
them, but they will be considered valid until the &quot;expiry&quot; of the token is
reached. Unless, of course, you have a blacklist or check with Hydra if the
token was revoked, which however defeats the purpose of using JSON Web Tokens
in the first place.</li>
<li><strong>Certain OpenID Connect features will not work</strong> when using JSON Web Tokens
as Access Tokens, such as the pariwise subject identifier algorithm.</li>
<li><strong>There is a better solution: Use
<a href="https://github.com/ory/oathkeeper">ORY Oathkeeper</a>!</strong> ORY Oathkeeper is a
proxy you deploy in front of your services. It will &quot;convert&quot; ORY Hydra's
opaque Access Tokens into JSON Web Tokens for your backend services. This
allows your services to work without additional REST Calls while solving all
previous points. <strong>We really recommend this option if you want JWTs!</strong></li>
</ol>
<p>If you are not convinced that ORY Oathkeeper is the right tool for the job, you
can still enable JSON Web Tokens in ORY Hydra by setting:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">strategies:</span>
  <span class="hljs-attr">access_token:</span> <span class="hljs-string">jwt</span>
</code></pre>
<p>Be aware that only access tokens are formatted as JSON Web Tokens. Refresh
tokens are not impacted by this strategy. By performing OAuth 2.0 Token
Introspection you can check if the token is still valid. If a token is revoked
or otherwise blacklisted, the OAuth 2.0 Token Introspection will return
<code>{ &quot;active&quot;: false }</code>. This is useful when you do not want to rely only on the
token's expiry.</p>
<h4><a class="anchor" aria-hidden="true" id="json-web-token-validation"></a><a href="#json-web-token-validation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JSON Web Token Validation</h4>
<p>You can validate JSON Web Tokens issued by ORY Hydra by pointing your <code>jwt</code>
library (e.g. <a href="https://github.com/auth0/node-jwks-rsa">node-jwks-rsa</a>) to
<code>http://ory-hydra-public-api/.well-known/jwks.json</code>. All necessary keys are
available there.</p>
<h3><a class="anchor" aria-hidden="true" id="oauth-20-client-authentication-with-rsa-privatepublic-keypairs"></a><a href="#oauth-20-client-authentication-with-rsa-privatepublic-keypairs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OAuth 2.0 Client Authentication with RSA private/public keypairs</h3>
<p>ORY Hydra supports OAuth 2.0 Client Authentication with RSA private/public
keypairs. This authentication method replaces the classic HTTP Basic
Authorization and HTTP POST Authorization schemes. Instead of sending the
<code>client_id</code> and <code>client_secret</code>, you authenticate the client with a signed JSON
Web Token.</p>
<p>To enable this feature for a specific OAuth 2.0 Client, you must set
<code>token_endpoint_auth_method</code> to <code>private_key_jwt</code> and register the public key of
the RSA signing key either using the <code>jwks_uri</code> or <code>jwks</code> fields of the client.</p>
<p>When authenticating the client at the token endpoint, you generate and sign
(with the RSA private key) a JSON Web Token with the following claims:</p>
<ul>
<li><code>iss</code>: REQUIRED. Issuer. This MUST contain the client_id of the OAuth Client.</li>
<li><code>sub</code>: REQUIRED. Subject. This MUST contain the client_id of the OAuth Client.</li>
<li><code>aud</code>: REQUIRED. Audience. The aud (audience) Claim. Value that identifies the
Authorization Server (ORY Hydra) as an intended audience. The Authorization
Server MUST verify that it is an intended audience for the token. The Audience
SHOULD be the URL of the Authorization Server's Token Endpoint.</li>
<li><code>jti</code>: REQUIRED. JWT ID. A unique identifier for the token, which can be used
to prevent reuse of the token. These tokens MUST only be used once, unless
conditions for reuse were negotiated between the parties; any such negotiation
is beyond the scope of this specification.</li>
<li><code>exp</code>: REQUIRED. Expiration time on or after which the ID Token MUST NOT be
accepted for processing.</li>
<li><code>iat</code>: OPTIONAL. Time at which the JWT was issued.</li>
</ul>
<p>When making a request to the <code>/oauth2/token</code> endpoint, you include
<code>client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer</code>
and <code>client_assertion=&lt;signed-jwt&gt;</code> in the request body:</p>
<pre><code class="hljs"><span class="hljs-keyword">POST</span> <span class="hljs-string">/oauth2/token</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: my-hydra.com
<span class="hljs-attribute">Content-Type</span>: application/x-www-form-urlencoded

<span class="routeros"><span class="hljs-attribute">grant_type</span>=authorization_code&amp;
<span class="hljs-attribute">code</span>=i1WsRn1uB1&amp;
<span class="hljs-attribute">client_id</span>=s6BhdRkqt3&amp;
client_assertion_type=
urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer&amp;
<span class="hljs-attribute">client_assertion</span>=PHNhbWxwOl <span class="hljs-built_in">..</span>. ZT
</span></code></pre>
<p>Here's what a client with a <code>jwks</code> looks like:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"client_id"</span>: <span class="hljs-string">"client-jwks"</span>,
  <span class="hljs-attr">"jwks"</span>: {
    <span class="hljs-attr">"keys"</span>: [
      {
        <span class="hljs-attr">"kty"</span>: <span class="hljs-string">"RSA"</span>,
        <span class="hljs-attr">"n"</span>: <span class="hljs-string">"jL7h5wc-yeMUsHGJHc0xe9SbTdaLKXMHvcIHQck20Ji7SvrHPdTDQTvZtTDS_wJYbeShcCrliHvbJRSZhtEe0mPJpyWg3O_HkKy6_SyHepLK-_BR7HfcXYB6pVJCG3BW-lVMY7gl5sULFA74kNZH50h8hdmyWC9JgOHn0n3YLdaxSWlhctuwNPSwqwzY4qtN7_CZub81SXWpKiwj4UpyB10b8rM8qn35FS1hfsaFCVi0gQpd4vFDgFyqqpmiwq8oMr8RZ2mf0NMKCP3RXnMhy9Yq8O7lgG2t6g1g9noWbzZDUZNc54tv4WGFJ_rJZRz0jE_GR6v5sdqsDTdjFquPlQ"</span>,
        <span class="hljs-attr">"e"</span>: <span class="hljs-string">"AQAB"</span>
      }
    ]
  },
  <span class="hljs-attr">"token_endpoint_auth_method"</span>: <span class="hljs-string">"private_key_jwt"</span>
}
</code></pre>
<p>And with <code>jwks_uri</code>:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"client_id"</span>: <span class="hljs-string">"client-jwks-uri"</span>,
  <span class="hljs-attr">"jwks_uri"</span>: <span class="hljs-string">"http://path-to-my-public/keys.json"</span>,
  <span class="hljs-attr">"token_endpoint_auth_method"</span>: <span class="hljs-string">"private_key_jwt"</span>
}
</code></pre>
<p>The <code>jwks_uri</code> must return a JSON object containing the public keys associated
with the OAuth 2.0 Client:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"keys"</span>: [
    {
      <span class="hljs-attr">"kty"</span>: <span class="hljs-string">"RSA"</span>,
      <span class="hljs-attr">"n"</span>: <span class="hljs-string">"jL7h5wc-yeMUsHGJHc0xe9SbTdaLKXMHvcIHQck20Ji7SvrHPdTDQTvZtTDS_wJYbeShcCrliHvbJRSZhtEe0mPJpyWg3O_HkKy6_SyHepLK-_BR7HfcXYB6pVJCG3BW-lVMY7gl5sULFA74kNZH50h8hdmyWC9JgOHn0n3YLdaxSWlhctuwNPSwqwzY4qtN7_CZub81SXWpKiwj4UpyB10b8rM8qn35FS1hfsaFCVi0gQpd4vFDgFyqqpmiwq8oMr8RZ2mf0NMKCP3RXnMhy9Yq8O7lgG2t6g1g9noWbzZDUZNc54tv4WGFJ_rJZRz0jE_GR6v5sdqsDTdjFquPlQ"</span>,
      <span class="hljs-attr">"e"</span>: <span class="hljs-string">"AQAB"</span>
    }
  ]
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="openid-connect"></a><a href="#openid-connect" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OpenID Connect</h2>
<h3><a class="anchor" aria-hidden="true" id="subject-identifier-algorithms"></a><a href="#subject-identifier-algorithms" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subject Identifier Algorithms</h3>
<p>Hydra supports two
<a href="http://openid.net/specs/openid-connect-core-1_0.html#SubjectIDTypes">Subject Identifier Algorithms</a>:</p>
<ul>
<li><code>public</code>: This provides the same <code>sub</code> (subject) value to all Clients
(default).</li>
<li><code>pairwise</code>: This provides a different <code>sub</code> value to each Client, so as not to
enable Clients to correlate the End-User's activities without permission.</li>
</ul>
<p>You can enable either one or both algorithms using the following configuration
layout:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">oidc:</span>
  <span class="hljs-attr">subject_identifiers:</span>
    <span class="hljs-attr">enabled:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">public</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">pairwise</span>
</code></pre>
<p>When <code>pairwise</code> is enabled, you must also set
<code>oidc.subject_identifiers.pairwise.salt</code>. The salt is used to obfuscate the
<code>sub</code> value:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">oidc:</span>
  <span class="hljs-attr">subject_identifiers:</span>
    <span class="hljs-attr">enabled:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">public</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">pairwise</span>
    <span class="hljs-attr">pairwise:</span>
      <span class="hljs-attr">salt:</span> <span class="hljs-string">some-salt</span>
</code></pre>
<p><strong>This value should not be changed once set in production. Changing it will
cause all client applications to receive new user IDs from ORY Hydra which will
lead to serious complications with authentication on their side!</strong></p>
<p>Each OAuth 2.0 Client has a configuration field <code>subject_type</code>. The value of
that <code>subject_type</code> is either <code>public</code> or <code>pairwise</code>. If the identifier
algorithm is enabled, ORY Hydra will choose the right strategy automatically.</p>
<p>While ORY Hydra handles <code>sub</code> obfuscation out of the box, you may also override
this value with your own obfuscated <code>sub</code> value by setting
<code>force_subject_identifier</code> when accepting the login challenge in your user login
app.</p>
<h2><a class="anchor" aria-hidden="true" id="cors"></a><a href="#cors" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CORS</h2>
<p>Both ORY Hydra's Admin and Public endpoints support CORS. For detailed
information, head over to the exemplary
<a href="https://github.com/ory/hydra/blob/master/docs/config.yaml">config file</a>.</p>
<p>For CORS to work properly, we encourage to set the following values:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">serve:</span>
  <span class="hljs-attr">admin:</span>
    <span class="hljs-attr">cors:</span>
      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">allowed_origins:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">https://example.com</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">https://*.example.com</span>
      <span class="hljs-attr">allowed_methods:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">POST</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">GET</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">PUT</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">PATCH</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">DELETE</span>
      <span class="hljs-attr">allowed_headers:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">Authorization</span>
      <span class="hljs-attr">exposed_headers:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">Content-Type</span>
  <span class="hljs-attr">public:</span>
    <span class="hljs-attr">cors:</span>
      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">allowed_origins:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">https://example.com</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">https://*.example.com</span>
      <span class="hljs-attr">allowed_methods:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">POST</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">GET</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">PUT</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">PATCH</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">DELETE</span>
      <span class="hljs-attr">allowed_headers:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">Authorization</span>
      <span class="hljs-attr">exposed_headers:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">Content-Type</span>
</code></pre>
<p>Keep in mind that the OAuth 2.0 Authorization Endpoint (<code>/oauth2/auth</code>) does not
expose CORS by design. This endpoint should never be consumed in a CORS-fashion.
Some endpoints (<code>/oauth2/token</code>, <code>/userinfo</code>, <code>/oauth2/revoke</code>) additionally
include URLs listed in field <code>allowed_cors_origins</code> of the OAuth 2.0 Client that
is making the request. For example, OAuth 2.0 Client</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"client_id"</span>: <span class="hljs-string">"foo"</span>,
  <span class="hljs-attr">"allowed_cors_origins"</span>: [<span class="hljs-string">"https://foo-bar.com/"</span>]
}
</code></pre>
<p>is allowed to make CORS request to <code>/oauth2/token</code> from origin
<code>https://foo-bar.com/</code> even if that origin is not listed in
<code>public.cors.allowed_origins</code>.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 10/8/2019 by prettifier[bot]</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/next/hydra/debugging"><span class="arrow-prev">← </span><span>Debugging</span></a><a class="docs-next button" href="/docs/next/hydra/integration"><span>Consuming OAuth 2.0</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#mobile--browser-spa-authorization">Mobile &amp; Browser (SPA) Authorization</a><ul class="toc-headings"><li><a href="#creating-a-public-oauth-20-client">Creating a public OAuth 2.0 Client</a></li></ul></li><li><a href="#key-rotation">Key rotation</a><ul class="toc-headings"><li><a href="#rotation-of-json-web-token-signing-keys">Rotation of JSON Web Token Signing Keys</a></li><li><a href="#rotation-of-hmac-token-signing-and-database-and-cookie-encryption-keys">Rotation of HMAC Token Signing and Database and Cookie Encryption Keys</a></li></ul></li><li><a href="#oauth-20">OAuth 2.0</a><ul class="toc-headings"><li><a href="#audience">Audience</a></li><li><a href="#json-web-tokens">JSON Web Tokens</a></li><li><a href="#oauth-20-client-authentication-with-rsa-privatepublic-keypairs">OAuth 2.0 Client Authentication with RSA private/public keypairs</a></li></ul></li><li><a href="#openid-connect">OpenID Connect</a><ul class="toc-headings"><li><a href="#subject-identifier-algorithms">Subject Identifier Algorithms</a></li></ul></li><li><a href="#cors">CORS</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2020 ORY GmbH</section><div id="codefund"></div><script src="https://codefund.io/properties/140/funder.js" async=""></script><script>(function () {
  document.querySelectorAll('.tabs .tabs-nav .nav-item a').forEach(function (t) {
    t.addEventListener("click", function (e) {
      e.preventDefault();

      t.closest('.tabs-nav').querySelectorAll('.nav-item a').forEach(function (i) {
        i.classList.remove('active');
      });

      t.closest('.tabs').querySelectorAll('.tab-content .tab-pane').forEach(function (i) {
        i.classList.remove('active');
      });

      t.classList.add('active');
      document.getElementById(t.href.split('#')[1]).classList.add('active');
      return false
    });
  });
})();</script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '8463c6ece843b377565726bb4ed325b0',
                indexName: 'ory',
                inputSelector: '#search_input_react'
              });
            </script></body></html>