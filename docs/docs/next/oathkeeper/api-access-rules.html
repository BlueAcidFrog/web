<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>API Access Rules · ORY Documentation</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="ORY Oathkeeper reaches decisions to allow or deny access by applying Access"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="API Access Rules · ORY Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://www.ory.sh/"/><meta property="og:description" content="ORY Oathkeeper reaches decisions to allow or deny access by applying Access"/><meta property="og:image" content="https://www.ory.sh/images/logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://www.ory.sh/images/logo.png"/><link rel="shortcut icon" href="/images/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-71865250-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/images/logo.svg" alt="ORY Documentation"/></a><a href="/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/" target="_self">Home</a></li><li class=""><a href="/blog" target="_self">Blog</a></li><li class=""><a href="https://community.ory.sh" target="_self">Forum</a></li><li class=""><a href="/chat" target="_self">Chat</a></li><li class="siteNavGroupActive"><a href="/docs/next/" target="_self">Docs</a></li><li class=""><a href="https://github.com/ory/" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Core Concepts</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Welcome<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/">ORY Developer Documentation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Ecosystem<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/projects">Projects</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/software-architecture-philosophy">Software Architecture and Philosophy</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/deployment">Deployment Fundamentals and Requirements</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/configuring">Configuring ORY services</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/versioning">Software Versions and Project Maturity</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/upgrading">Software Updates</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/api-design">API Design</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/community">Community</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/roadmap">Roadmap</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ecosystem/sqa">Software Quality Assurance</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Kratos<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Introduction</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/quickstart">Quickstart</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/install">Installation</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Concepts</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/ui-user-interface">User Interface</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/identity-user-model">Identity and User Model</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/credentials">Credentials</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/email-sms">Out-of-band communication via E-Mail and SMS</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/federation">Federation</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/concepts/security">Threat Models and Security Profiles</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Self Service Flows</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/flows/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/flows/user-login-user-registration">User Login and User Registration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/flows/user-logout">User Logout</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/flows/user-profile-management">Profile Management</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/flows/password-reset-account-recovery">Account Recovery</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/flows/user-facing-errors">User-Facing Errors</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/flows/verify-email-account-activation">Email and Phone Verification and Account Activation</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Self Service Strategies</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/strategies/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/strategies/username-email-password">Username or Email and Password</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/strategies/openid-connect-social-sign-in-oauth2">Social Sign In with OpenID Connect and OAuth2</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Self Service Jobs and Workflows</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/workflows/jobs/before">Before Jobs</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/self-service/workflows/jobs/after">After Jobs</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Reference</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/reference/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/reference/json-schema-json-paths">JSON Schema and JSON Paths</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/reference/html-forms">HTML Form Parser</a></li><li class="navListItem"><a class="navItem" href="/docs/next/kratos/sdk/api">REST API</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">SDKs</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/sdk/">Overview</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Further Reading</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/kratos/further-reading/comparison">Comparison</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Hydra<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/hydra/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/install">Installation</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Concepts</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/hydra/oauth2">OAuth 2.0</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/login-consent-flow">Hydra workflow</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Integrating Hydra into your stack</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/hydra/5min-tutorial">5 Minute Tutorial</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/implementing-consent">Login, Consent &amp; Logout</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/case-study">OAuth 2.0 Case Study</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/hydra/configure-deploy">Installation and Setup</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/dependencies-environment">Database Setup and Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/production">Preparing for Production</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/debugging">Debugging</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/advanced">Advanced Topics</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/integration">Consuming OAuth 2.0</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">API &amp; SDKs</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/hydra/sdk/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/sdk/api">REST API</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/sdk/go">Go</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/sdk/js">JavaScript</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/sdk/php">PHP</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Further Reading</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/hydra/limitations">Limitations</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/jwks">JSON Web Key Sets</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/security-architecture">Security Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/next/hydra/faq">FAQ</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Oathkeeper<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/install">Installation</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Core Concepts</h4><ul><li class="navListItem navListItemActive"><a class="navItem" href="/docs/next/oathkeeper/api-access-rules">API Access Rules</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Pipeline Handlers</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/pipeline/">Access Rule Pipeline</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/pipeline/authn">Authenticators</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/pipeline/authz">Authorizers</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/pipeline/mutator">Mutators</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/pipeline/error">Error Handlers</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/configure-deploy">Configure and Deploy</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">API &amp; SDKs</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/sdk/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/oathkeeper/sdk/api">REST API</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORY Keto<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/keto/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/install">Installation</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/keto/configure-deploy">Configure and Deploy</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/secure">Secure</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Control Engines</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/keto/engines/">Access Control Engines - Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/engines/acl">Access Control Lists (ACL)</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/engines/rbac">Role Based Access Control (RBAC)</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/engines/acp-ory">ORY Access Control Policies</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/engines/acp-aws">AWS IAM Policies</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">API &amp; SDKs</h4><ul><li class="navListItem"><a class="navItem" href="/docs/next/keto/sdk/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/keto/sdk/api">REST API</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Performance<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/performance/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/next/performance/hydra">ORY Hydra</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/ory/docs/edit/master/docs/oathkeeper/api-access-rules.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">API Access Rules</h1></header><article><div><span><p>ORY Oathkeeper reaches decisions to allow or deny access by applying Access
Rules. Access Rules can be stored on the file system, set as an environment
variable, or fetched from HTTP(s) remotes. These repositories can be configured
in the configuration file (<code>oathkeeper -c ./path/to/config.yml ...</code>)</p>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># Configures Access Rules</span>
<span class="hljs-attr">access_rules:</span>
  <span class="hljs-comment"># Locations (list of URLs) where access rules should be fetched from on boot.</span>
  <span class="hljs-comment"># It is expected that the documents at those locations return a JSON or YAML Array containing ORY Oathkeeper Access Rules.</span>
  <span class="hljs-attr">repositories:</span>
    <span class="hljs-comment"># If the URL Scheme is `file://`, the access rules (an array of access rules is expected) will be</span>
    <span class="hljs-comment"># fetched from the local file system.</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">file://path/to/rules.json</span>
    <span class="hljs-comment"># If the URL Scheme is `inline://`, the access rules (an array of access rules is expected)</span>
    <span class="hljs-comment"># are expected to be a base64 encoded (with padding!) JSON/YAML string (base64_encode(`[{"id":"foo-rule","authenticators":[....]}]`)):</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">inline://W3siaWQiOiJmb28tcnVsZSIsImF1dGhlbnRpY2F0b3JzIjpbXX1d</span>
    <span class="hljs-comment"># If the URL Scheme is `http://` or `https://`, the access rules (an array of access rules is expected) will be</span>
    <span class="hljs-comment"># fetched from the provided HTTP(s) location.</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">https://path-to-my-rules/rules.json</span>
  <span class="hljs-comment"># Determines a matching strategy for the access rules . Currently supported values are `glob` and `regexp`. Empty string defaults to regexp.</span>
  <span class="hljs-attr">matching_strategy:</span> <span class="hljs-string">glob</span>
</code></pre>
<p>or by setting the equivalent environment variable:</p>
<pre><code class="hljs css language-bash">$ <span class="hljs-built_in">export</span> ACCESS_RULES_REPOSITORIES=<span class="hljs-string">'file://path/to/rules.json,https://path-to-my-rules/rules.json,inline://W3siaWQiOiJmb28tcnVsZSIsImF1dGhlbnRpY2F0b3JzIjpbXX1d'</span>
</code></pre>
<p>The repository (file, inline, remote) must be formatted either as a JSON or a
YAML array containing the access rules:</p>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> cat ./rules.json</span>
[{
    "id": "my-first-rule"
},{
    "id": "my-second-rule"
}]
<span class="hljs-meta">
$</span><span class="bash"> cat ./rules.yaml</span>
- id: my-first-rule
  version: v0.36.0-beta.4
  authenticators:
    - handler: noop
- id: my-second-rule
  version: v0.36.0-beta.4
  authorizer:
    handler: allow
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="access-rule-format"></a><a href="#access-rule-format" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Access Rule Format</h2>
<p>Access Rules have four principal keys:</p>
<ul>
<li><code>id</code> (string): The unique ID of the Access Rule.</li>
<li><code>version</code> (string): The version of ORY Oathkeeper this rule targets with out
the <code>+oryOS.&lt;x&gt;</code> appendix. ORY Oathkeeper is able to migrate access rules
across versions. If left empty ORY Oathkeeper will assume that the rule is
using the same tag as the version that is running.</li>
<li><code>upstream</code> (object): The location of the server where requests matching this
rule should be forwarded to. This only needs to be set when using the ORY
Oathkeeper Proxy as the Decision API does not forward the request to the
upstream.
<ul>
<li><code>url</code> (string): The URL the request will be forwarded to.</li>
<li><code>preserve_host</code> (bool): If set to <code>false</code> (default), the forwarded request
will include the host and port of the <code>url</code> value. If <code>true</code>, the host and
port of the ORY Oathkeeper Proxy will be used instead:
<ul>
<li><code>false</code>: Incoming HTTP Header <code>Host: mydomain.com</code>-&gt; Forwarding HTTP
Header <code>Host: someservice.intranet.mydomain.com:1234</code></li>
</ul></li>
<li><code>strip_path</code> (string): If set, replaces the provided path prefix when
forwarding the requested URL to the upstream URL:
<ul>
<li>set to <code>/api/v1</code>: Incoming HTTP Request at <code>/api/v1/users</code> -&gt; Forwarding
HTTP Request at <code>/users</code>.</li>
<li>unset: Incoming HTTP Request at <code>/api/v1/users</code> -&gt; Forwarding HTTP Request
at <code>/api/v1/users</code>.</li>
</ul></li>
</ul></li>
<li><code>match</code> (object): Defines the URL(s) this Access Rule should match.
<ul>
<li><code>methods</code> (string[]): Array of HTTP methods (e.g. GET, POST, PUT, DELETE,
...).</li>
<li><code>url</code> (string): The URL that should be matched. You can use regular
expressions or glob patterns in this field to match more than one url. The
matching strategy (glob or regexp) is defined in the global configuration
file as <code>access_rules.matching_strategy</code>. This matcher ignores query
parameters. Regular expressions (or glob patterns) are encapsulated in
brackets <code>&lt;</code> and <code>&gt;</code>. Regular expressions examples:
<ul>
<li><code>https://mydomain.com/</code> matches <code>https://mydomain.com/</code> and does not match
<code>https://mydomain.com/foo</code> or <code>https://mydomain.com</code>.</li>
<li><code>&lt;https|http&gt;://mydomain.com/&lt;.*&gt;</code> matches:<code>https://mydomain.com/</code> or
<code>http://mydomain.com/foo</code>. Does not match: <code>https://other-domain.com/</code> or
<code>https://mydomain.com</code>.</li>
<li><code>http://mydomain.com/&lt;[[:digit:]]+&gt;</code> matches <code>http://mydomain.com/123</code> and
does not match <code>http://mydomain/abc</code>.</li>
<li><code>http://mydomain.com/&lt;(?!protected).*&gt;</code> matches
<code>http://mydomain.com/resource</code> and does not match
<code>http://mydomain.com/protected</code>
<a href="http://tldp.org/LDP/GNU-Linux-Tools-Summary/html/x11655.htm">Glop</a>
patterns examples:</li>
<li><code>https://mydomain.com/&lt;m?n&gt;</code> matches <code>https://mydomain.com/man</code> and does
not match <code>http://mydomain.com/foo</code>.</li>
<li><code>https://mydomain.com/&lt;{foo*,bar*}&gt;</code> matches <code>https://mydomain.com/foo</code> or
<code>https://mydomain.com/bar</code> and does not match <code>https://mydomain.com/any</code>.</li>
</ul></li>
</ul></li>
<li><code>authenticators</code>: A list of authentication handlers that authenticate the
provided credentials. Authenticators are checked iteratively from index <code>0</code> to
<code>n</code> and the first authenticator to return a positive result will be the one
used. If you want the rule to first check a specific authenticator before
&quot;falling back&quot; to others, have that authenticator as the first item in the
array. For the full list of available authenticators, click
<a href="/docs/next/oathkeeper/pipeline/authn">here</a>.</li>
<li><code>authorizer</code>: The authorization handler which will try to authorize the
subject (&quot;user&quot;) from the previously validated credentials making the request.
For example, you could check if the subject (&quot;user&quot;) is part of the &quot;admin&quot;
group or if he/she has permission to perform that action. For the full list of
available authorizers, click <a href="/docs/next/oathkeeper/pipeline/authz">here</a>.</li>
<li><code>mutators</code>: A list of mutation handlers that transform the HTTP request before
forwarding it. A common use case is generating a new set of credentials (e.g.
JWT) which then will be forwarded to the upstream server. When using ORY
Oathkeeper's Decision API, it is expected that the API Gateway forwards the
mutated HTTP Headers to the upstream server. For the full list of available
mutators, click <a href="/docs/next/oathkeeper/pipeline/mutator">here</a>.</li>
<li><code>errors</code>: A list of error handlers that are executed when any of the previous
handlers (e.g. authentication) fail. Error handlers define what to do in case
of an error, for example redirect the user to the login endpoint when a
unauthorized (HTTP Status Code 401) error occurs. If left unspecified, errors
will always be handled as JSON responses unless the global configuration key
<code>errors.fallback</code> was changed. For more information on error handlers, click
<a href="/docs/next/oathkeeper/pipeline/error">here</a>.</li>
</ul>
<p><strong>Examples</strong></p>
<p>Rule in JSON format:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"some-id"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"v0.36.0-beta.4"</span>,
  <span class="hljs-attr">"upstream"</span>: {
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://my-backend-service"</span>,
    <span class="hljs-attr">"preserve_host"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"strip_path"</span>: <span class="hljs-string">"/api/v1"</span>
  },
  <span class="hljs-attr">"match"</span>: {
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://my-app/some-route/&lt;.*&gt;"</span>,
    <span class="hljs-attr">"methods"</span>: [<span class="hljs-string">"GET"</span>, <span class="hljs-string">"POST"</span>]
  },
  <span class="hljs-attr">"authenticators"</span>: [{ <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"noop"</span> }],
  <span class="hljs-attr">"authorizer"</span>: { <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"allow"</span> },
  <span class="hljs-attr">"mutators"</span>: [{ <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"noop"</span> }],
  <span class="hljs-attr">"errors"</span>: [{ <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"json"</span> }]
}
</code></pre>
<p>Rule in YAML format:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">id:</span> <span class="hljs-string">some-id</span>
<span class="hljs-attr">version:</span> <span class="hljs-string">v0.36.0-beta.4</span>
<span class="hljs-attr">upstream:</span>
  <span class="hljs-attr">url:</span> <span class="hljs-string">http://my-backend-service</span>
  <span class="hljs-attr">preserve_host:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">strip_path:</span> <span class="hljs-string">/api/v1</span>
<span class="hljs-attr">match:</span>
  <span class="hljs-attr">url:</span> <span class="hljs-string">http://my-app/some-route/&lt;.*&gt;</span>
  <span class="hljs-attr">methods:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">GET</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">POST</span>
<span class="hljs-attr">authenticators:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">handler:</span> <span class="hljs-string">noop</span>
<span class="hljs-attr">authorizer:</span>
  <span class="hljs-attr">hander:</span> <span class="hljs-string">allow</span>
<span class="hljs-attr">mutators:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">handler:</span> <span class="hljs-string">noop</span>
<span class="hljs-attr">errors:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">handler:</span> <span class="hljs-string">json</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="handler-configuration"></a><a href="#handler-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Handler configuration</h2>
<p>Handlers (Authenticators, Mutators, Authorizers, Errors) sometimes require
configuration. The configuration can be defined globally as well as per Access
Rule. The configuration from the Access Rule is overrides values from the global
configuration.</p>
<p><strong>oathkeeper.yml</strong></p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">authenticators:</span>
  <span class="hljs-attr">anonymous:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">subject:</span> <span class="hljs-string">anon</span>
</code></pre>
<p><strong>rule.json</strong></p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"some-id"</span>,
  <span class="hljs-attr">"upstream"</span>: {
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://my-backend-service"</span>,
    <span class="hljs-attr">"preserve_host"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"strip_path"</span>: <span class="hljs-string">"/api/v1"</span>
  },
  <span class="hljs-attr">"match"</span>: {
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://my-app/some-route/&lt;.*&gt;"</span>,
    <span class="hljs-attr">"methods"</span>: [<span class="hljs-string">"GET"</span>, <span class="hljs-string">"POST"</span>]
  },
  <span class="hljs-attr">"authenticators"</span>: [
    { <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"anonymous"</span>, <span class="hljs-attr">"config"</span>: { <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"anon"</span> } }
  ],
  <span class="hljs-attr">"authorizer"</span>: { <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"allow"</span> },
  <span class="hljs-attr">"mutators"</span>: [{ <span class="hljs-attr">"handler"</span>: <span class="hljs-string">"noop"</span> }]
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="scoped-credentials"></a><a href="#scoped-credentials" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scoped Credentials</h2>
<p>Some credentials are scoped. For example, OAuth 2.0 Access Tokens usually are
scoped (&quot;OAuth 2.0 Scope&quot;). Scope validation depends on the meaning of the
scope. Therefore, wherever ORY Oathkeeper validates a scope, these scope
strategies are supported:</p>
<ul>
<li><code>hierarchic</code>: Scope <code>foo</code> matches <code>foo</code>, <code>foo.bar</code>, <code>foo.baz</code> but not <code>bar</code></li>
<li><code>wildcard</code>: Scope <code>foo.*</code> matches <code>foo</code>, <code>foo.bar</code>, <code>foo.baz</code> but not <code>bar</code>.
Scope <code>foo</code> matches <code>foo</code> but not <code>foo.bar</code> nor <code>bar</code></li>
<li><code>exact</code>: Scope <code>foo</code> matches <code>foo</code> but not <code>bar</code> nor <code>foo.bar</code></li>
<li><code>none</code>: Scope validation is disabled. If however a scope is configured to be
validated, the request will fail with an error message.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="match-strategy-behavior"></a><a href="#match-strategy-behavior" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Match strategy behavior</h2>
<p>With the <strong>Regular expression</strong> strategy, you can use the extracted groups in
all handlers where the substitutions are supported by using the Go
<a href="https://golang.org/pkg/text/template/"><code>text/template</code></a> package, receiving the
<a href="https://github.com/ory/oathkeeper/blob/master/pipeline/authn/authenticator.go#L39">AuthenticationSession</a>
struct:</p>
<pre><code class="hljs css language-go"><span class="hljs-keyword">type</span> AuthenticationSession <span class="hljs-keyword">struct</span> {
    Subject      <span class="hljs-keyword">string</span>
    Extra        <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>{}
    Header       http.Header
    MatchContext MatchContext
}

<span class="hljs-keyword">type</span> MatchContext <span class="hljs-keyword">struct</span> {
    RegexpCaptureGroups []<span class="hljs-keyword">string</span>
    URL                 *url.URL
}
</code></pre>
<p><strong>Examples</strong></p>
<p>If the match URL is <code>&lt;https|http&gt;://mydomain.com/&lt;.*&gt;</code> and the request is
<code>http://mydomain.com/foo</code>, the <code>MatchContext</code> field will contain</p>
<ul>
<li><code>RegexpCaptureGroups</code>: [&quot;http&quot;, &quot;foo&quot;]</li>
<li><code>URL</code>: &quot;<a href="http://mydomain.com/foo">http://mydomain.com/foo</a>&quot;</li>
</ul>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 3/25/2020 by Patrik</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/next/oathkeeper/install"><span class="arrow-prev">← </span><span>Installation</span></a><a class="docs-next button" href="/docs/next/oathkeeper/pipeline/index"><span>Access Rule Pipeline</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#access-rule-format">Access Rule Format</a></li><li><a href="#handler-configuration">Handler configuration</a></li><li><a href="#scoped-credentials">Scoped Credentials</a></li><li><a href="#match-strategy-behavior">Match strategy behavior</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2020 ORY GmbH</section><div id="codefund"></div><script src="https://codefund.io/properties/140/funder.js" async=""></script><script>(function () {
  document.querySelectorAll('.tabs .tabs-nav .nav-item a').forEach(function (t) {
    t.addEventListener("click", function (e) {
      e.preventDefault();

      t.closest('.tabs-nav').querySelectorAll('.nav-item a').forEach(function (i) {
        i.classList.remove('active');
      });

      t.closest('.tabs').querySelectorAll('.tab-content .tab-pane').forEach(function (i) {
        i.classList.remove('active');
      });

      t.classList.add('active');
      document.getElementById(t.href.split('#')[1]).classList.add('active');
      return false
    });
  });
})();</script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '8463c6ece843b377565726bb4ed325b0',
                indexName: 'ory',
                inputSelector: '#search_input_react'
              });
            </script></body></html>