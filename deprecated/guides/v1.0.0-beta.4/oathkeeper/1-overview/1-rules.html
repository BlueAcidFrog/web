
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Access Rules Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Aeneas Rekkas">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-etoc/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-versions-ory/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="2-installation.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Overview</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    ORY Developer Guide
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">updating</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../updating/">
            
                <a href="../../updating/">
            
                    
                    Performing Software Updates
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">ORY Hydra</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../hydra/">
            
                <a href="../../hydra/">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../../hydra/1-tutorial/">
            
                <a href="../../hydra/1-tutorial/">
            
                    
                    5 Minute Tutorial
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../../hydra/2-environment/">
            
                <a href="../../hydra/2-environment/">
            
                    
                    Dependencies & Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.2.1" data-path="../../hydra/2-environment/1-securing-ory-hydra.html">
            
                <a href="../../hydra/2-environment/1-securing-ory-hydra.html">
            
                    
                    Securing ORY Hydra
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../../hydra/3-overview/">
            
                <a href="../../hydra/3-overview/">
            
                    
                    Concepts and Theory
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.3.1" data-path="../../hydra/3-overview/1-oauth2.html">
            
                <a href="../../hydra/3-overview/1-oauth2.html">
            
                    
                    OAuth 2.0 & OpenID Connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.2" data-path="../../hydra/3-overview/2-jwk.html">
            
                <a href="../../hydra/3-overview/2-jwk.html">
            
                    
                    JSON Web Keys (JWK)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="../../hydra/4-install/">
            
                <a href="../../hydra/4-install/">
            
                    
                    Install, Configure and Run ORY Hydra
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="../../hydra/5-security/">
            
                <a href="../../hydra/5-security/">
            
                    
                    Security Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="../../hydra/6-how-to/">
            
                <a href="../../hydra/6-how-to/">
            
                    
                    How To
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.6.1" data-path="../../hydra/6-how-to/1-production.html">
            
                <a href="../../hydra/6-how-to/1-production.html">
            
                    
                    ORY Hydra in production
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.7" data-path="../../hydra/7-sdk/">
            
                <a href="../../hydra/7-sdk/">
            
                    
                    SDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.7.1" data-path="../../hydra/7-sdk/1-go.html">
            
                <a href="../../hydra/7-sdk/1-go.html">
            
                    
                    Go SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7.2" data-path="../../hydra/7-sdk/2-js.html">
            
                <a href="../../hydra/7-sdk/2-js.html">
            
                    
                    JavaScript SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7.3" data-path="../../hydra/7-sdk/3-php.html">
            
                <a href="../../hydra/7-sdk/3-php.html">
            
                    
                    PHP SDK
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.8" data-path="../../hydra/8-faq/">
            
                <a href="../../hydra/8-faq/">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">ORY Oathkeeper</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="./">
            
                <a href="./">
            
                    
                    Quickstart
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="4.1.1.1" data-path="1-rules.html">
            
                <a href="1-rules.html">
            
                    
                    Access Rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.2" data-path="2-installation.html">
            
                <a href="2-installation.html">
            
                    
                    Installing ORY Oathkeeper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.3" data-path="3-configuration.html">
            
                <a href="3-configuration.html">
            
                    
                    Configuring and Running ORY Oathkeeper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.4" data-path="4-deployment.html">
            
                <a href="4-deployment.html">
            
                    
                    Deployment
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">ORY Keto</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../keto/">
            
                <a href="../../keto/">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="../../keto/1-overview/">
            
                <a href="../../keto/1-overview/">
            
                    
                    Quickstart
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1.1" data-path="../../keto/1-overview/1-policies.html">
            
                <a href="../../keto/1-overview/1-policies.html">
            
                    
                    Access Control Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.1.2" data-path="../../keto/1-overview/2-warden.html">
            
                <a href="../../keto/1-overview/2-warden.html">
            
                    
                    Access Control: The Warden API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.1.3" data-path="../../keto/1-overview/3-roles.html">
            
                <a href="../../keto/1-overview/3-roles.html">
            
                    
                    Roles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.1.4" data-path="../../keto/1-overview/4-best-practices.html">
            
                <a href="../../keto/1-overview/4-best-practices.html">
            
                    
                    Best Practices
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.1.5" data-path="../../keto/1-overview/5-conditions.html">
            
                <a href="../../keto/1-overview/5-conditions.html">
            
                    
                    Conditions and Context
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.1.6" data-path="../../keto/1-overview/6-installation.html">
            
                <a href="../../keto/1-overview/6-installation.html">
            
                    
                    Installing ORY Keto
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.1.7" data-path="../../keto/1-overview/7-configuration.html">
            
                <a href="../../keto/1-overview/7-configuration.html">
            
                    
                    Configuring and Running ORY Keto
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Performance Benchmarks</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../../performance/">
            
                <a href="../../performance/">
            
                    
                    Performance Benchmarks
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="../../performance/1-hydra.html">
            
                <a href="../../performance/1-hydra.html">
            
                    
                    ORY Hydra Performance Benchmarks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Telemetry</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../../telemetry/">
            
                <a href="../../telemetry/">
            
                    
                    Telemetry
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Access Rules</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="access-rules">Access Rules</h1>
<p>ORY Oathkeeper decides whether or not access should be allowed with Access Rules. Access Rules can be managed using the
ORY Oathkeeper API.</p>
<!-- toc --><div id="toc" class="toc">

<ul>
<li><a href="#overview">Overview</a><ul>
<li><a href="#authenticators">Authenticators</a><ul>
<li><a href="#noop"><code>noop</code></a><ul>
<li><a href="#example">Example</a></li>
</ul>
</li>
<li><a href="#anonymous"><code>anonymous</code></a><ul>
<li><a href="#example-1">Example</a></li>
</ul>
</li>
<li><a href="#oauth2clientcredentials"><code>oauth2_client_credentials</code></a><ul>
<li><a href="#example-2">Example</a></li>
</ul>
</li>
<li><a href="#oauth2introspection"><code>oauth2_introspection</code></a><ul>
<li><a href="#example-3">Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#authorizers">Authorizers</a><ul>
<li><a href="#allow"><code>allow</code></a></li>
<li><a href="#example-4">Example</a></li>
<li><a href="#deny"><code>deny</code></a></li>
<li><a href="#example-5">Example</a></li>
<li><a href="#ketowarden"><code>keto_warden</code></a></li>
<li><a href="#example-6">Example</a></li>
</ul>
</li>
<li><a href="#credentials-issuers">Credentials Issuers</a><ul>
<li><a href="#noop-1"><code>noop</code></a><ul>
<li><a href="#example-7">Example</a></li>
</ul>
</li>
<li><a href="#idtoken"><code>id_token</code></a><ul>
<li><a href="#token-signing-algorithms">Token Signing Algorithms</a></li>
<li><a href="#access-rule-configuration">Access Rule Configuration</a></li>
<li><a href="#example-8">Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#rule-management">Rule Management</a><ul>
<li><a href="#rules-rest-api">Rules REST API</a></li>
<li><a href="#rules-cli-api">Rules CLI API</a></li>
</ul>
</li>
</ul>

</div><!-- tocstop -->
<h2 id="overview">Overview</h2>
<p>An ORY Oathkeeper Access Rule has the following layout:</p>
<pre><code>{
    &quot;id&quot;: &quot;some-id&quot;,
    &quot;upstream&quot;: {
        &quot;url&quot;: &quot;http://my-backend-service&quot;
    },
    &quot;match&quot;: {
        &quot;url&quot;: &quot;http://my-app/some-route&quot;,
        &quot;methods&quot;: [
            &quot;GET&quot;
        ]
    },
    &quot;authenticators&quot;: [/* ... */],
    &quot;authorizer&quot;: {/* ... */},
    &quot;credentials_issuer&quot;: { /* ... */ }
}
</code></pre><p>In this case, if a request to <code>http://my-app/some-route</code> is made (this is where ORY Oathkeeper will listen to), then
the rule with ID <code>some-id</code> will be executed. If the request is authorized successfully, it will be forwarded to
the upstream URL.</p>
<p>The <code>match.url</code> value is capable of parsing regular expressions. Value <code>http://my-app/some-route</code> will only
match this exact URL, not <code>http://my-app/some-route/foo</code>, <code>http://my-app/some-ROUTE</code>, nor <code>https://my-app/some-route</code>.</p>
<p>Regular expressions are delimited with <code>&lt;</code> and <code>&gt;</code>. A <code>match.url</code> value of <code>http://my-app/some-route&lt;.*&gt;</code> will match
<code>http://my-app/some-route/foo</code>, <code>http://my-app/some-route</code>, <code>http://my-app/some-routeABCDEF</code>, and so on. You can
use multiple regular expressions: <code>&lt;http|https&gt;://my-app/some-route&lt;.*&gt;</code>.</p>
<p>The <code>match.methods</code> value defines which HTTP methods this access rule will match. The rule <code>some-id</code> will, for example,
not match POST requests.</p>
<p>ORY Oathkeeper will throw an error if more than one access rule is found for a given HTTP request. You have to make sure
that your access rules don&apos;t overlap.</p>
<p>Once an access rule is matched, ORY Oathkeeper will authenticate the credentials, authorize the request subject (e.g. the user),
and transform the credentials. More on that in the next sections.</p>
<h3 id="authenticators">Authenticators</h3>
<p>An authenticator is responsible for authenticating request credentials. ORY Oathkeeper supports different authenticators
and we will add more as the project progresses.</p>
<p>An authenticator inspects the HTTP request (e.g. the HTTP Authorization Header) and executes some business logic that
returns true (for authentication ok) or false (for authentication invalid) as well as a subject ID. The subject ID is
typically the &quot;user&quot; that made the request, but it could also be a machine (if you have machine-2-machine interaction) or
something different.</p>
<p>Each authenticator has the same configuration layout</p>
<pre><code>&quot;authenticators&quot;: [
    {
        &quot;handler&quot;: &quot;a&quot;,
        &quot;config&quot;: {/* depends on the authenticator */}
    }
]
</code></pre><p>where <code>handler</code> is the name of the authenticator and <code>config</code> is an optional configuration for that specific
authenticator.</p>
<p>You can define more than one authenticator in the access rule. The first authenticator that is able to handle the
credentials will be consulted and other authenticators will be ignored:</p>
<pre><code>&quot;authenticators&quot;: [
    {
        &quot;handler&quot;: &quot;a&quot;
    },
    {
        &quot;handler&quot;: &quot;b&quot;
    },
    {
        &quot;handler&quot;: &quot;c&quot;
    }
]
</code></pre><p>If handler <code>a</code> is able to handle the provided credentials, then handler <code>b</code> and <code>c</code> will be ignored. If handler <code>a</code>
can not handle the provided credentials but handler <code>b</code> can, then handler <code>a</code> and <code>b</code> will be ignored. Handling
the provided credentials means that the authenticator knows how to handle, for example, the <code>Authorization: basic</code> header.
It does not mean that the credentials are valid! If a handler encounters invalid credentials, then other handlers will be ignored too.</p>
<p>Let&apos;s take a look at the different supported authenticators!</p>
<h4 id="noop"><code>noop</code></h4>
<p>This is a special authenticator. It tells ORY Oathkeeper to bypass the authentication process. This also implies
that no authorization will be executed and no credentials will be issued. It&apos;s basically a pass-all authenticator
that allows any request to be forwarded to the upstream URL.</p>
<h5 id="example">Example</h5>
<p>The following rule allows all requests to <code>GET http://my-app/some-route</code>:</p>
<pre><code>{
    &quot;id&quot;: &quot;some-id&quot;,
    &quot;upstream&quot;: {
        &quot;url&quot;: &quot;http://my-backend-service&quot;
    },
    &quot;match&quot;: {
        &quot;url&quot;: &quot;http://my-app/some-route&quot;,
        &quot;methods&quot;: [
            &quot;GET&quot;
        ]
    },
    &quot;authenticators&quot;: [{
        &quot;handler&quot;: &quot;noop&quot;
    }]
}
</code></pre><h4 id="anonymous"><code>anonymous</code></h4>
<p>The <code>anonymous</code> authenticator checks whether or not an <code>Authorization</code> header is set. If not, it will use the value
of the environment variable <code>AUTHENTICATOR_ANONYMOUS_USERNAME</code> as the subject name.</p>
<h5 id="example">Example</h5>
<p>The following rule allows all requests to <code>GET http://my-app/some-route</code> and sets the subject name to the value
of the environment variable <code>AUTHENTICATOR_ANONYMOUS_USERNAME</code>, as long as no <code>Authorization</code> header is set in the
HTTP request:</p>
<pre><code>{
    &quot;id&quot;: &quot;some-id&quot;,
    &quot;upstream&quot;: {
        &quot;url&quot;: &quot;http://my-backend-service&quot;
    },
    &quot;match&quot;: {
        &quot;url&quot;: &quot;http://my-app/some-route&quot;,
        &quot;methods&quot;: [
            &quot;GET&quot;
        ]
    },
    &quot;authenticators&quot;: [{
        &quot;handler&quot;: &quot;anonymous&quot;
    }],
    /* ... */
}
</code></pre><h4 id="oauth2clientcredentials"><code>oauth2_client_credentials</code></h4>
<p>This <code>oauth2_client_credentials</code> uses the username and password from HTTP Basic Authorization (<code>Authorization: basic base64(&lt;username:password&gt;)</code>
to perform the OAuth 2.0 Client Credentials grant in order to detect if the provided credentials are valid.</p>
<p>To use this authenticator, you must provide the environment variable <code>AUTHENTICATOR_OAUTH2_CLIENT_CREDENTIALS_TOKEN_URL</code>
which sets the OAuth 2.0 Token URL that should be used to check if the provided credentials are valid or not. For
example, you could set it as follows:</p>
<pre><code>$ export AUTHENTICATOR_OAUTH2_CLIENT_CREDENTIALS_TOKEN_URL=https://my-oauth2-server/oauth2/token
</code></pre><p>This authenticator will use the username from the HTTP Basic Authorization header as the subject for this request.</p>
<p>This authenticator has one configuration option which is <code>required_scope</code>. This option sets what scope is
required by the URL and when making performing OAuth 2.0 Client Credentials request, the scope will be included
in the request.</p>
<h5 id="example">Example</h5>
<p>The following rule allows requests to <code>GET http://my-app/some-route</code> if valid a OAuth 2.0 Client ID and Client Secret
has been provided and if that client is allowed to request scope <code>scope-a</code> and <code>scope-b</code>:</p>
<pre><code>{
    &quot;id&quot;: &quot;some-id&quot;,
    &quot;upstream&quot;: {
        &quot;url&quot;: &quot;http://my-backend-service&quot;
    },
    &quot;match&quot;: {
        &quot;url&quot;: &quot;http://my-app/some-route&quot;,
        &quot;methods&quot;: [
            &quot;GET&quot;
        ]
    },
    &quot;authenticators&quot;: [{
        &quot;handler&quot;: &quot;oauth2_client_credentials&quot;,
        &quot;config&quot;: {
            &quot;required_scope&quot;: [&quot;scope-a&quot;, &quot;scope-b&quot;]
        }
    }],
    /* ... */
}
</code></pre><h4 id="oauth2introspection"><code>oauth2_introspection</code></h4>
<p>The <code>oauth2_introspection</code> authenticator handles requests that have an Bearer Token in the Authorization Header (<code>Authorization: bearer &lt;token&gt;</code>).
It then uses OAuth 2.0 Token Introspection to check if the token is valid and if the token was granted the requested scope.</p>
<p>This authenticator is a bit more complex to set up. You have to define the following environment variables:</p>
<ul>
<li>Required<ul>
<li><code>AUTHENTICATOR_OAUTH2_INTROSPECTION_CLIENT_ID</code>: The OAuth 2.0 Client ID the client that performs the OAuth 2.0 Token Introspection. The OAuth 2.0 Token Introspection
endpoint is typically protected and requires a valid OAuth 2.0 Client in order to check if a token is valid or not.</li>
<li><code>AUTHENTICATOR_OAUTH2_INTROSPECTION_CLIENT_SECRET</code>: The OAuth 2.0 Client Secret of the client that performs the OAuth 2.0 Token Introspection.</li>
<li><code>AUTHENTICATOR_OAUTH2_INTROSPECTION_TOKEN_URL</code>: The OAuth 2.0 Token URL.</li>
<li><code>AUTHENTICATOR_OAUTH2_INTROSPECTION_INTROSPECT_URL</code>: The OAuth 2.0 Token Introspection URL.</li>
</ul>
</li>
<li>Optional<ul>
<li><code>AUTHENTICATOR_OAUTH2_INTROSPECTION_SCOPE</code>: If the OAuth 2.0 Token Introspection endpoint requires a certain OAuth 2.0 Scope
in order to be accessed, you can set it using this environment variable. Use commas to define more than one OAuth 2.0 Scope.
Example: <code>AUTHENTICATOR_OAUTH2_INTROSPECTION_SCOPE=scope-a,scope-b</code></li>
</ul>
</li>
</ul>
<h5 id="example">Example</h5>
<p>The following rule allows requests to <code>GET http://my-app/some-route</code> if valid a OAuth 2.0 Access Token was provided
and if that token was granted OAuth 2.0 Scope <code>scope-a</code> and <code>scope-b</code>:</p>
<pre><code>{
    &quot;id&quot;: &quot;some-id&quot;,
    &quot;upstream&quot;: {
        &quot;url&quot;: &quot;http://my-backend-service&quot;
    },
    &quot;match&quot;: {
        &quot;url&quot;: &quot;http://my-app/some-route&quot;,
        &quot;methods&quot;: [
            &quot;GET&quot;
        ]
    },
    &quot;authenticators&quot;: [{
        &quot;handler&quot;: &quot;oauth2_introspection&quot;,
        &quot;config&quot;: {
            &quot;required_scope&quot;: [&quot;scope-a&quot;, &quot;scope-b&quot;]
        }
    }],
    /* ... */
}
</code></pre><h3 id="authorizers">Authorizers</h3>
<p>The authorizer takes the subject returned from the authenticator and checks if that subject is allowed to perform
the requested action.</p>
<p>Each authorizer has the same configuration layout</p>
<pre><code>&quot;authorizer&quot;: {
    &quot;handler&quot;: &quot;a&quot;,
    &quot;config&quot;: {/* depends on the authorizer */}
}
</code></pre><h4 id="allow"><code>allow</code></h4>
<p>This authorizer allows every request to pass.</p>
<h4 id="example">Example</h4>
<pre><code>{
    &quot;id&quot;: &quot;some-id&quot;,
    &quot;upstream&quot;: {
        &quot;url&quot;: &quot;http://my-backend-service&quot;
    },
    &quot;match&quot;: {
        &quot;url&quot;: &quot;http://my-app/some-route&quot;,
        &quot;methods&quot;: [
            &quot;GET&quot;
        ]
    },
    &quot;authenticators&quot;: [/* ... */],
    &quot;authorizer&quot;: {
        &quot;handler&quot;: &quot;allow&quot;
    }
    /* ... */
}
</code></pre><h4 id="deny"><code>deny</code></h4>
<p>This authorizer denies every request.</p>
<h4 id="example">Example</h4>
<pre><code>{
    &quot;id&quot;: &quot;some-id&quot;,
    &quot;upstream&quot;: {
        &quot;url&quot;: &quot;http://my-backend-service&quot;
    },
    &quot;match&quot;: {
        &quot;url&quot;: &quot;http://my-app/some-route&quot;,
        &quot;methods&quot;: [
            &quot;GET&quot;
        ]
    },
    &quot;authenticators&quot;: [/* ... */],
    &quot;authorizer&quot;: {
        &quot;handler&quot;: &quot;deny&quot;
    }
    /* ... */
}
</code></pre><h4 id="ketowarden"><code>keto_warden</code></h4>
<p>This authorizer uses the ORY Keto Warden API to perform sophisticated access control with access control policies.
Please familiarize yourself with the ORY Keto project before you set up this authorizer.</p>
<p>To configure this authorizer, you must set the environment variable <code>AUTHORIZER_KETO_WARDEN_KETO_URL</code> to ORY Keto&apos;s URL,
for example <code>AUTHORIZER_KETO_WARDEN_KETO_URL=http://keto/</code>. <strong>If this environment variable is not set, then this authorizer
will be disabled.</strong></p>
<p>This authorizer has two configuration options, <code>required_action</code> and <code>required_resource</code>:</p>
<pre><code>&quot;authorizer&quot;: {
    &quot;handler&quot;: &quot;keto_warden&quot;,
    &quot;config&quot;: {
        &quot;required_action&quot;: &quot;...&quot;
        &quot;required_resource&quot;: &quot;...&quot;
    }
}
</code></pre><p>These configuration options support variable expansion. Let&apos;s say you have the following match configuration:</p>
<pre><code>&quot;match&quot;: {
    &quot;url&quot;: &quot;http://my-app/api/users/&lt;[0-9]+&gt;/&lt;[a-zA-Z]+&gt;&quot;,
    &quot;methods&quot;: [&quot;GET&quot;]
},
</code></pre><p>Here, you have two regular expressions, <code>&lt;[0-9]+&gt;</code> and <code>&lt;[a-zA-Z]+&gt;</code>. You can reference the values matched by the
regular expression with <code>$1</code> and <code>$2</code> (and more generally <code>$n</code>) and they will be substituted before making the request
to ORY Keto:</p>
<pre><code>&quot;config&quot;: {
    &quot;required_action&quot;: &quot;my:action:$1&quot;,
    &quot;required_resource&quot;: &quot;my:resource:$2:foo:$1&quot;
}
</code></pre><p>Assuming a request to <code>http://my-api/api/users/1234/foobar</code> was made, the config from above would expand to:</p>
<pre><code>&quot;config&quot;: {
    &quot;required_action&quot;: &quot;my:action:1234&quot;,
    &quot;required_resource&quot;: &quot;my:resource:foobar:foo:1234&quot;
}
</code></pre><h4 id="example">Example</h4>
<pre><code>{
    &quot;id&quot;: &quot;some-id&quot;,
    &quot;upstream&quot;: {
        &quot;url&quot;: &quot;http://my-backend-service&quot;
    },
    &quot;match&quot;: {
        &quot;url&quot;: &quot;http://my-app/api/users/&lt;[0-9]+&gt;/&lt;[a-zA-Z]+&gt;&quot;,
        &quot;methods&quot;: [
            &quot;GET&quot;
        ]
    },
    &quot;authenticators&quot;: [/* ... */],
    &quot;authorizer&quot;: {
        &quot;handler&quot;: &quot;deny&quot;,
        &quot;config&quot;: {
            &quot;required_action&quot;: &quot;my:action:$1&quot;,
            &quot;required_resource&quot;: &quot;my:resource:$2:foo:$1&quot;
        }
    }
    /* ... */
}
</code></pre><h3 id="credentials-issuers">Credentials Issuers</h3>
<p>A credentials issuer translates the credentials from incoming requests to credentials that you backend understands.
For example, the <code>Authorization: basic</code> header might be transformed to <code>X-User: &lt;subject-id&gt;</code>. This allows you to
write backends that do not care if the original request was an anonymous one, an OAuth 2.0 Access Token, or some other
credential type. All your backend has to do is understand, for example, the <code>X-User:</code>.</p>
<h4 id="noop"><code>noop</code></h4>
<p>This credentials issuer does not transform the HTTP request and simply forwards the headers as-is. This is useful
if you don&apos;t want to replace, for example, <code>Authorization: basic</code> with <code>X-User: &lt;subject-id&gt;</code>.</p>
<h5 id="example">Example</h5>
<pre><code>{
    &quot;id&quot;: &quot;some-id&quot;,
    &quot;upstream&quot;: {
        &quot;url&quot;: &quot;http://my-backend-service&quot;
    },
    &quot;match&quot;: {
        &quot;url&quot;: &quot;http://my-app/api/users/&lt;[0-9]+&gt;/&lt;[a-zA-Z]+&gt;&quot;,
        &quot;methods&quot;: [
            &quot;GET&quot;
        ]
    },
    &quot;authenticators&quot;: [/* ... */],
    &quot;authorizer&quot;: {/* ... */ }
    &quot;credentials_issuer&quot; {
        &quot;handler&quot;: &quot;noop&quot;
    }
}
</code></pre><h4 id="idtoken"><code>id_token</code></h4>
<p>This credentials issuer takes the authentication information (e.g. subject ID) and transforms it to a signed JSON Web Token,
and more specifically to an OpenID Connect ID Token. You backend can verify the token by fetching the (public) key
from the <code>/.well-known/jwks.json</code> endpoint.</p>
<p>Let&apos;s say a request is made to a resource protected by ORY Oathkeeper:</p>
<pre><code>GET /api/resource HTTP/1.1
Host: www.example.com
Authorization: bearer &lt;opaque-access-token&gt;
</code></pre><p>Assuming that ORY Oathkeeper is granting the access request, the <code>&lt;opaque-access-token&gt;</code> will be replaced with a
JSON Web Token that is signed using the asymmetric RS256 key:</p>
<pre><code>GET /api/resource HTTP/1.1
Host: internal-api-endpoint-dns
Authorization: bearer &lt;jwt-signed-id-token&gt;
</code></pre><p>Now, the protected resource is capable of decoding and validating the JSON Web Token using the public key supplied
by ORY Oathkeeper&apos;s API. The public key for decoding the ID token is available at Oathkeeper&apos;s <code>/.well-known/jwks.json</code> endpoint:</p>
<pre><code>http://oathkeeper:4456/.well-known/jwks.json
</code></pre><p>That <code>.well-known/jwks.json</code> endpoint is not served by the ORY Oathkeeper proxy process, but by
the ORY Oathkeeper API process. You will learn more about the difference between the two in the next chapters.</p>
<p>The related flow diagram looks like this:</p>
<p><img src="../images/id_token.svg" alt="ID Token Transformation"></p>
<p>Let&apos;s say the <code>oauth2_client_credentials</code> authenticator successfully authenticated the credentials <code>client-id:client-secret</code>.
This credentials issuer will craft an ID Token (JWT) with the following exemplary claims:</p>
<pre><code>{
  &quot;iss&quot;: &quot;https://server.example.com&quot;,
  &quot;sub&quot;: &quot;client-id&quot;,
  &quot;aud&quot;: &quot;s6BhdRkqt3&quot;,
  &quot;jti&quot;: &quot;n-0S6_WzA2Mj&quot;,
  &quot;exp&quot;: 1311281970,
  &quot;iat&quot;: 1311280970,
}
</code></pre><p>The ID Token Claims are as follows:</p>
<ul>
<li><code>iss</code>: Issuer Identifier for the Issuer of the response. The iss value is a case sensitive URL using the https scheme
  that contains scheme, host, and optionally, port number and path components and no query or fragment components.
  Typically, this is the URL of ORY Oathkeeper, for example: <code>https://oathkeeper.myapi.com</code>.</li>
<li><code>sub</code>: Subject Identifier. A locally unique and never reassigned identifier within the Issuer for the End-User, which
  is intended to be consumed by the Client, e.g., 24400320 or AItOawmwtWwcT0k51BayewNvutrJUqsvl6qs7A4. It must not
  exceed 255 ASCII characters in length. The sub value is a case sensitive string. The End-User might also
  be an OAuth 2.0 Client, given that the access token was granted using the OAuth 2.0 Client Credentials flow.</li>
<li><code>aud</code>: Audience(s) that this ID Token is intended for. It MUST contain the OAuth 2.0 client_id of the Relying Party
  as an audience value. It MAY also contain identifiers for other audiences. In the general case, the aud value is an
  array of case sensitive strings.</li>
<li><code>exp</code>: Expiration time on or after which the ID Token MUST NOT be accepted for processing. The processing of this
  parameter requires that the current date/time MUST be before the expiration date/time listed in the value.
  Its value is a JSON number representing the number of seconds from 1970-01-01T0:0:0Z as measured in UTC until the
  date/time. See RFC 3339 [RFC3339] for details regarding date/times in general and UTC in particular.</li>
<li><code>iat</code>: Time at which the JWT was issued. Its value is a JSON number representing the number of seconds
  from 1970-01-01T0:0:0Z as measured in UTC until the date/time.</li>
<li><code>jti</code>: A cryptographically strong random identifier to ensure the ID Token&apos;s uniqueness.</li>
</ul>
<p>This credentials issuer implements several token signing algorithms, specifically:</p>
<ul>
<li><code>HS256</code>: This algorithm uses a HMAC-SHA256 with a shared secret as opposed to private/public keys. This strategy
is not encouraged for production.</li>
<li><code>ORY-HYDRA</code>: This algorithm uses ORY Hydra&apos;s JWK management API to generate private/public RSA keypair. This strategy
is encouraged for use in production.</li>
</ul>
<p>You can set the strategy using the <code>CREDENTIALS_ISSUER_ID_TOKEN_ALGORITHM</code> environment variable. There also two more environment variables which modify
the behaviour of this strategy:</p>
<ul>
<li><code>CREDENTIALS_ISSUER_ID_TOKEN_LIFESPAN</code>: The lifespan of the ID Token which defaults to 10 minutes. Example:
  <code>CREDENTIALS_ISSUER_ID_TOKEN_LIFESPAN=1s</code> (1 second), <code>CREDENTIALS_ISSUER_ID_TOKEN_LIFESPAN=1m</code> (1 minute),
  <code>CREDENTIALS_ISSUER_ID_TOKEN_LIFESPAN=1h</code> (1 hour), <code>CREDENTIALS_ISSUER_ID_TOKEN_LIFESPAN=1d</code> (1 day)</li>
<li><code>CREDENTIALS_ISSUER_ID_TOKEN_ISSUER</code>: Who issued the token - this will be the value of the <code>iss</code> claim in the
  ID Token.</li>
</ul>
<h5 id="token-signing-algorithms">Token Signing Algorithms</h5>
<h6 id="hs256"><code>HS256</code></h6>
<p>The HS256 algorithm is the default one. This algorithm requires you to set the secret to be used for signing the ID Token.
Be aware that anyone in possession of this secret - also anyone having access to the <code>./well-known/jwks.json</code> URL
will be able to forge ID Tokens that will be accepted by your backends. We recommend using this strategy primarily
for development purposes.</p>
<p><strong>Do not use this strategy in production unless you know what you are doing.</strong> If you do use this in production, make sure
that <strong>noone</strong> (except the services validating the tokens) have access to the <code>./well-known/jwks.json</code> URL.</p>
<p>Use must use the <code>CREDENTIALS_ISSUER_ID_TOKEN_HS256_SECRET</code> environment variable to set the secret.</p>
<h6 id="ory-hydra"><code>ORY-HYDRA</code></h6>
<p>This ID Token signing algorithm uses ORY Hydra&apos;s JSON Web Key API to generate, store, and fetch a RSA public/private keypair.
When using this algorithm, you have the following environment variables available:</p>
<ul>
<li>Required<ul>
<li><code>CREDENTIALS_ISSUER_ID_TOKEN_HYDRA_URL</code>: The URL where ORY Hydra is located.</li>
</ul>
</li>
<li>Optional<ul>
<li><code>CREDENTIALS_ISSUER_ID_TOKEN_HYDRA_JWK_SET_ID</code>: The ID to be used to create &amp; fetch the JSON Web Key from ORY Hydra.
Defaults to <code>oathkeeper:id-token</code>.</li>
<li><code>CREDENTIALS_ISSUER_ID_TOKEN_JWK_REFRESH_INTERVAL</code>: ORY Oathkeeper stores JSON Web Keys for ID Token signing in memory.
This value sets the refresh interval. Default is 5 minutes.</li>
</ul>
</li>
</ul>
<h5 id="access-rule-configuration">Access Rule Configuration</h5>
<p>Additionally, this credentials issuer allows you to specify the audience of the ID token per access rule. Setting
the audience is optional:</p>
<pre><code>&quot;credentials_issuer&quot;: {
    &quot;handler&quot;: &quot;id_token&quot;,
    &quot;config&quot;: {
        &quot;aud&quot;: [&quot;audience-1&quot;, &quot;audience-2&quot;]
    }
}
</code></pre><h5 id="example">Example</h5>
<pre><code>{
    &quot;id&quot;: &quot;some-id&quot;,
    &quot;upstream&quot;: {
        &quot;url&quot;: &quot;http://my-backend-service&quot;
    },
    &quot;match&quot;: {
        &quot;url&quot;: &quot;http://my-app/api/users/&lt;[0-9]+&gt;/&lt;[a-zA-Z]+&gt;&quot;,
        &quot;methods&quot;: [
            &quot;GET&quot;
        ]
    },
    &quot;authenticators&quot;: [/* ... */],
    &quot;authorizer&quot;: {/* ... */ }
    &quot;credentials_issuer&quot;: {
        &quot;handler&quot;: &quot;id_token&quot;,
        &quot;config&quot;: {
            &quot;aud&quot;: [&quot;audience-1&quot;, &quot;audience-2&quot;]
        }
    }
}
</code></pre><h2 id="rule-management">Rule Management</h2>
<h3 id="rules-rest-api">Rules REST API</h3>
<p>For more information on available fields and exemplary payloads of rules, as well as rule management using HTTP
please refer to the <a href="https://www.ory.sh/docs/api/oathkeeper/" target="_blank">REST API docs</a></p>
<h3 id="rules-cli-api">Rules CLI API</h3>
<p>Management of rules is not only possible through the REST API, but additionally using the ORY Oathkeeper CLI.
For help on how to manage the CLI, type <code>oathkeeper help rules</code>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Quickstart">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="2-installation.html" class="navigation navigation-next " aria-label="Next page: Installing ORY Oathkeeper">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Access Rules","level":"4.1.1.1","depth":3,"next":{"title":"Installing ORY Oathkeeper","level":"4.1.1.2","depth":3,"path":"oathkeeper/1-overview/2-installation.md","ref":"oathkeeper/1-overview/2-installation.md","articles":[]},"previous":{"title":"Quickstart","level":"4.1.1","depth":2,"path":"oathkeeper/1-overview/README.md","ref":"oathkeeper/1-overview/README.md","articles":[{"title":"Access Rules","level":"4.1.1.1","depth":3,"path":"oathkeeper/1-overview/1-rules.md","ref":"oathkeeper/1-overview/1-rules.md","articles":[]},{"title":"Installing ORY Oathkeeper","level":"4.1.1.2","depth":3,"path":"oathkeeper/1-overview/2-installation.md","ref":"oathkeeper/1-overview/2-installation.md","articles":[]},{"title":"Configuring and Running ORY Oathkeeper","level":"4.1.1.3","depth":3,"path":"oathkeeper/1-overview/3-configuration.md","ref":"oathkeeper/1-overview/3-configuration.md","articles":[]},{"title":"Deployment","level":"4.1.1.4","depth":3,"path":"oathkeeper/1-overview/4-deployment.md","ref":"oathkeeper/1-overview/4-deployment.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["edit-link","auto-summary-ory","etoc","ga","sitemap-basepath","versions-ory","youtube"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"etoc":{"h2lb":2,"header":1,"maxdepth":5,"mindepth":2,"notoc":false},"youtube":{},"versions-ory":{"type":"branches"},"auto-summary":{"parts":{"README.md":"Overview","updating/*.md":"updating","hydra/**/*.md":"ORY Hydra","oathkeeper/**/*.md":"ORY Oathkeeper","keto/**/*.md":"ORY Keto","performance/*.md":"Performance Benchmarks","telemetry/*.md":"Telemetry"}},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sitemap-basepath":{"hostname":"https://www.ory.sh/","basePath":"/docs/guides/"},"auto-summary-ory":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"ga":{"configuration":"auto","token":"UA-71865250-1"},"versions":{"gitbookConfigURL":"https://raw.githubusercontent.com/ory/docs/master/guides/book.json","options":[{"value":"https://www.ory.sh/docs/guides/latest","text":"latest (stable)"},{"value":"https://www.ory.sh/docs/guides/v1.0.0-beta.3","text":"v1.0.0-beta.3"},{"value":"https://www.ory.sh/docs/guides/v1.0.0-beta.2","text":"v1.0.0-beta.2"},{"value":"https://www.ory.sh/docs/guides/v0.11.12","text":"0.11.12"},{"value":"https://www.ory.sh/docs/guides/master","text":"master (unstable)"}]},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit this page","base":"https://github.com/ory/docs/tree/master/guides"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Aeneas Rekkas","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":">=3.2.3"},"file":{"path":"oathkeeper/1-overview/1-rules.md","mtime":"2018-06-14T12:26:28.521Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-06-14T12:28:10.651Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-etoc/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-versions-ory/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

