
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Configuring and Running ORY Oathkeeper Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Aeneas Rekkas">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-etoc/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-versions-ory/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="4-deployment.html" />
    
    
    <link rel="prev" href="2-installation.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Overview</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    ORY Developer Guide
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">ORY Hydra</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../hydra/">
            
                <a href="../../hydra/">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../../hydra/1-tutorial/">
            
                <a href="../../hydra/1-tutorial/">
            
                    
                    5 Minute Tutorial
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="../../hydra/2-environment/">
            
                <a href="../../hydra/2-environment/">
            
                    
                    Dependencies & Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.2.1" data-path="../../hydra/2-environment/1-securing-ory-hydra.html">
            
                <a href="../../hydra/2-environment/1-securing-ory-hydra.html">
            
                    
                    Securing ORY Hydra
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="../../hydra/3-overview/">
            
                <a href="../../hydra/3-overview/">
            
                    
                    Concepts and Theory
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.3.1" data-path="../../hydra/3-overview/1-oauth2.html">
            
                <a href="../../hydra/3-overview/1-oauth2.html">
            
                    
                    OAuth 2.0 & OpenID Connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3.2" data-path="../../hydra/3-overview/2-jwk.html">
            
                <a href="../../hydra/3-overview/2-jwk.html">
            
                    
                    JSON Web Keys (JWK)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="../../hydra/4-install/">
            
                <a href="../../hydra/4-install/">
            
                    
                    Install, Configure and Run ORY Hydra
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="../../hydra/5-security/">
            
                <a href="../../hydra/5-security/">
            
                    
                    Security Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.6" data-path="../../hydra/6-how-to/">
            
                <a href="../../hydra/6-how-to/">
            
                    
                    How To
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.6.1" data-path="../../hydra/6-how-to/1-production.html">
            
                <a href="../../hydra/6-how-to/1-production.html">
            
                    
                    ORY Hydra in production
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.7" data-path="../../hydra/7-sdk/">
            
                <a href="../../hydra/7-sdk/">
            
                    
                    SDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.7.1" data-path="../../hydra/7-sdk/1-go.html">
            
                <a href="../../hydra/7-sdk/1-go.html">
            
                    
                    Go SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7.2" data-path="../../hydra/7-sdk/2-js.html">
            
                <a href="../../hydra/7-sdk/2-js.html">
            
                    
                    JavaScript SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7.3" data-path="../../hydra/7-sdk/3-php.html">
            
                <a href="../../hydra/7-sdk/3-php.html">
            
                    
                    PHP SDK
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.8" data-path="../../hydra/8-faq/">
            
                <a href="../../hydra/8-faq/">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">ORY Oathkeeper</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="./">
            
                <a href="./">
            
                    
                    Quickstart
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1.1" data-path="1-rules.html">
            
                <a href="1-rules.html">
            
                    
                    Access Rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.1.2" data-path="2-installation.html">
            
                <a href="2-installation.html">
            
                    
                    Installing ORY Oathkeeper
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.1.1.3" data-path="3-configuration.html">
            
                <a href="3-configuration.html">
            
                    
                    Configuring and Running ORY Oathkeeper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.1.4" data-path="4-deployment.html">
            
                <a href="4-deployment.html">
            
                    
                    Deployment
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">ORY Keto (wip)</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../keto/">
            
                <a href="../../keto/">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../../keto/1-overview/">
            
                <a href="../../keto/1-overview/">
            
                    
                    Quickstart
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1.1" data-path="../../keto/1-overview/1-policies.html">
            
                <a href="../../keto/1-overview/1-policies.html">
            
                    
                    Access Control Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.2" data-path="../../keto/1-overview/2-warden.html">
            
                <a href="../../keto/1-overview/2-warden.html">
            
                    
                    Access Control: The Warden API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.3" data-path="../../keto/1-overview/3-roles.html">
            
                <a href="../../keto/1-overview/3-roles.html">
            
                    
                    Roles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.4" data-path="../../keto/1-overview/4-best-practices.html">
            
                <a href="../../keto/1-overview/4-best-practices.html">
            
                    
                    Best Practices
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.5" data-path="../../keto/1-overview/5-conditions.html">
            
                <a href="../../keto/1-overview/5-conditions.html">
            
                    
                    Conditions and Context
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.6" data-path="../../keto/1-overview/6-installation.html">
            
                <a href="../../keto/1-overview/6-installation.html">
            
                    
                    Installing ORY Keto
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.7" data-path="../../keto/1-overview/7-configuration.html">
            
                <a href="../../keto/1-overview/7-configuration.html">
            
                    
                    Configuring and Running ORY Keto
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Telemetry</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../telemetry/">
            
                <a href="../../telemetry/">
            
                    
                    Telemetry
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Configuring and Running ORY Oathkeeper</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="configuring-and-running-ory-oathkeeper">Configuring and Running ORY Oathkeeper</h1>
<!-- toc --><div id="toc" class="toc">

<ul>
<li><a href="#create-a-network">Create a Network</a></li>
<li><a href="#start-the-postgresql-container">Start the PostgreSQL Container</a></li>
<li><a href="#run-the-ory-oathkeeper-api-proxy">Run the ORY Oathkeeper API Proxy</a><ul>
<li><a href="#creating-your-first-access-rule">Creating your first access rule</a></li>
</ul>
</li>
</ul>

</div><!-- tocstop -->
<p>ORY Oathkeeper has two servers that run on separate ports:</p>
<ul>
<li>The api server: This server is responsible for exposing the management REST API.</li>
<li>The proxy server: This server is responsible for evaluating access requests and forwarding them to the backend.</li>
</ul>
<p>For detailed documentation on the two servers, run <code>oathkeeper help serve api</code> and <code>oathkeeper help serve proxy</code>.</p>
<p>ORY Oathkeeper supports two types of storage adapters:</p>
<ul>
<li>In-memory: This adapter does not work with more than one instance (&quot;cluster&quot;) and any state is lost after restarting the instance.</li>
<li>SQL: This adapter works with more than one instance and state is not lost after restarts.</li>
</ul>
<p>The SQL adapter supports two DBMS: PostgreSQL 9.6+ and MySQL 5.7+. Please note that
older MySQL versions have issues with the database schema.
For more information <a href="https://github.com/ory/hydra/issues/377" target="_blank">go here</a>.</p>
<p>ORY Oathkeeper supports various authentication, authorization, and credential strategies. Depending on what strategies
you want to use, you will have to configure more services (e.g. ORY Hydra or ORY Keto). In this tutorial, we will
set up ORY Oathkeeper without any of the other services. Please refer to the <a href="1-rules">authenticator, authorizer, and credentials
issuer documentation</a> to see what you need to configure in order to get the strategies you need.</p>
<p>This guide will:</p>
<ol>
<li>Download and run a PostgreSQL container in Docker.</li>
<li>Download and run ORY Oathkeeper using Docker.</li>
</ol>
<h2 id="create-a-network">Create a Network</h2>
<p>Before we can start, a network must be created which we will attach all our Docker containers to. That way, the containers
can talk to one another.</p>
<pre><code>$ docker network create oathkeeperguide
</code></pre><h2 id="start-the-postgresql-container">Start the PostgreSQL Container</h2>
<p>For the purpose of this tutorial, we will use PostgreSQL as a database. As you probably already know, don&apos;t run databases in Docker in production!
For the sake of this tutorial however, let&apos;s use Docker to quickly deploy the database.</p>
<pre><code>$ docker run \
  --network oathkeeperguide \
  --name ory-oathkeeper-example--postgres \
  -e POSTGRES_USER=oathkeeper \
  -e POSTGRES_PASSWORD=secret \
  -e POSTGRES_DB=oathkeeper \
  -d postgres:9.6
</code></pre><p>This command wil start a postgres instance with name <code>ory-oathkeeper-example--postgres</code>, set up a database called <code>oathkeeper</code>
and create a user <code>oathkeeper</code> with password <code>secret</code>.</p>
<h2 id="run-the-ory-oathkeeper-api-proxy">Run the ORY Oathkeeper API Proxy</h2>
<pre><code># The database url points us at the postgres instance. This could also be an ephermal in-memory database (`export DATABASE_URL=memory`)
# or a MySQL URI.
$ export DATABASE_URL=postgres://oathkeeper:secret@ory-oathkeeper-example--postgres:5432/oathkeeper?sslmode=disable

# This pulls the latest image from Docker Hub
$ docker pull oryd/oathkeeper:v1.0.0-beta.2

# ORY Oathkeeper does not do magic, it requires conscious decisions, for example running SQL migrations which is required
# when installing a new version of ORY Oathkeeper, or upgrading an existing installation.
# It is the equivalent to `oathkeeper migrate sql postgres://oathkeeper:secret@ory-oathkeeper-example--postgres:5432/oathkeeper?sslmode=disable`
$ docker run -it --rm \
  --network oathkeeperguide \
  oryd/oathkeeper:v1.0.0-beta.2 \
  migrate sql $DATABASE_URL

Applying `client` SQL migrations...
[...]
Migration successful!

# Next, let&apos;s run the API server!
$ docker run -d \
  --name ory-oathkeeper-example--oathkeeper-api \
  --network oathkeeperguide \
  -p 4456:4456 \
  -e DATABASE_URL=$DATABASE_URL \
  oryd/oathkeeper:v1.0.0-beta.2 \
  serve api

# And the proxy server too - take not that we need to link the proxy serve with the API server!
$ docker run -d \
  --name ory-oathkeeper-example--oathkeeper-proxy \
  --network oathkeeperguide \
  -p 4455:4455 \
  -e OATHKEEPER_API_URL=http://ory-oathkeeper-example--oathkeeper-api:4456/ \
  oryd/oathkeeper:v1.0.0-beta.2 \
  serve proxy
</code></pre><p>Great, both the API and the proxy server are running now! Make sure to check the logs and see if there were
any errors or issues before going to the next steps:</p>
<pre><code>$ docker logs ory-oathkeeper-example--oathkeeper-api
$ docker logs ory-oathkeeper-example--oathkeeper-proxy
</code></pre><h3 id="creating-your-first-access-rule">Creating your first access rule</h3>
<p><strong>Sorry, this section is still work in progress.</strong></p>
<ol>
<li>Create the rule using <code>oathkeeper rules import</code> - need to figure out how to add the file to docker to make this work.</li>
<li>Have a rule that works immediately, e.g. protect an Oathkeeper API URL using the Oathkeeper proxy</li>
<li>Have two CURL requests where one fails and one passes. Explain why that happens</li>
<li>Clean up</li>
</ol>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="2-installation.html" class="navigation navigation-prev " aria-label="Previous page: Installing ORY Oathkeeper">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="4-deployment.html" class="navigation navigation-next " aria-label="Next page: Deployment">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Configuring and Running ORY Oathkeeper","level":"3.1.1.3","depth":3,"next":{"title":"Deployment","level":"3.1.1.4","depth":3,"path":"oathkeeper/1-overview/4-deployment.md","ref":"oathkeeper/1-overview/4-deployment.md","articles":[]},"previous":{"title":"Installing ORY Oathkeeper","level":"3.1.1.2","depth":3,"path":"oathkeeper/1-overview/2-installation.md","ref":"oathkeeper/1-overview/2-installation.md","articles":[]},"dir":"ltr"},"config":{"plugins":["edit-link","auto-summary-ory","etoc","ga","sitemap-basepath","versions-ory","youtube"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"etoc":{"h2lb":2,"header":1,"maxdepth":5,"mindepth":2,"notoc":false},"youtube":{},"versions-ory":{"type":"branches"},"auto-summary":{"parts":{"README.md":"Overview","hydra/**/*.md":"ORY Hydra","oathkeeper/**/*.md":"ORY Oathkeeper","keto/**/*.md":"ORY Keto (wip)","telemetry/*.md":"Telemetry"}},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sitemap-basepath":{"hostname":"https://www.ory.sh/","basePath":"/docs/guides/"},"auto-summary-ory":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"ga":{"configuration":"auto","token":"UA-71865250-1"},"versions":{"gitbookConfigURL":"https://raw.githubusercontent.com/ory/docs/master/guides/book.json","options":[{"value":"https://www.ory.sh/docs/guides/latest","text":"latest (stable)"},{"value":"https://www.ory.sh/docs/guides/v1.0.0-beta.2","text":"v1.0.0-beta.2"},{"value":"https://www.ory.sh/docs/guides/v0.11.12","text":"0.11.12"},{"value":"https://www.ory.sh/docs/guides/master","text":"master (unstable)"}]},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit this page","base":"https://github.com/ory/docs/tree/master/guides"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Aeneas Rekkas","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":">=3.2.3"},"file":{"path":"oathkeeper/1-overview/3-configuration.md","mtime":"2018-05-29T14:12:07.628Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-05-29T14:13:34.675Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-etoc/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-versions-ory/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

