
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Security Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Aeneas Rekkas">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-etoc/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-versions-ory/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="../3-Deyploment/0-README.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../1-hydra/">
            
                <a href="../../1-hydra/">
            
                    
                    ORY Hydra
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../1-hydra/0-tutorial/0-README.html">
            
                <a href="../../1-hydra/0-tutorial/0-README.html">
            
                    
                    5 Minute Tutorial
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../1-hydra/1-environment/0-README.html">
            
                <a href="../../1-hydra/1-environment/0-README.html">
            
                    
                    Dependencies & Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../1-hydra/2-overview/0-README.html">
            
                <a href="../../1-hydra/2-overview/0-README.html">
            
                    
                    Concepts and Theory
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../../1-hydra/2-overview/1-oauth2.html">
            
                <a href="../../1-hydra/2-overview/1-oauth2.html">
            
                    
                    OAuth 2.0 & OpenID Connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../../1-hydra/2-overview/2-jwk.html">
            
                <a href="../../1-hydra/2-overview/2-jwk.html">
            
                    
                    JSON Web Keys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../../1-hydra/2-overview/3-access-control.html">
            
                <a href="../../1-hydra/2-overview/3-access-control.html">
            
                    
                    Access Control
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../../1-hydra/3-install/0-README.html">
            
                <a href="../../1-hydra/3-install/0-README.html">
            
                    
                    Install, Configure and Run ORY Hydra
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../../1-hydra/4-security/0-README.html">
            
                <a href="../../1-hydra/4-security/0-README.html">
            
                    
                    Security Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../../1-hydra/5-telemetry/0-README.html">
            
                <a href="../../1-hydra/5-telemetry/0-README.html">
            
                    
                    Telemetry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../../1-hydra/6-how-to/0-README.html">
            
                <a href="../../1-hydra/6-how-to/0-README.html">
            
                    
                    How To
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.7.1" data-path="../../1-hydra/6-how-to/1-production.html">
            
                <a href="../../1-hydra/6-how-to/1-production.html">
            
                    
                    ORY Hydra in production
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../../1-hydra/7-sdk/0-README.html">
            
                <a href="../../1-hydra/7-sdk/0-README.html">
            
                    
                    SDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.8.1" data-path="../../1-hydra/7-sdk/1-go.html">
            
                <a href="../../1-hydra/7-sdk/1-go.html">
            
                    
                    Go SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.2" data-path="../../1-hydra/7-sdk/2-js.html">
            
                <a href="../../1-hydra/7-sdk/2-js.html">
            
                    
                    JavaScript SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.3" data-path="../../1-hydra/7-sdk/3-php.html">
            
                <a href="../../1-hydra/7-sdk/3-php.html">
            
                    
                    PHP SDK
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../../1-hydra/8-faq/0-README.html">
            
                <a href="../../1-hydra/8-faq/0-README.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../">
            
                <a href="../">
            
                    
                    ORY Oathkeeper
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../1-Quickstart/0-README.html">
            
                <a href="../1-Quickstart/0-README.html">
            
                    
                    Quickstart
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../1-Quickstart/1-INSTALLATION.html">
            
                <a href="../1-Quickstart/1-INSTALLATION.html">
            
                    
                    Installing ORY Oathkeeper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../1-Quickstart/2-EXECUTION.html">
            
                <a href="../1-Quickstart/2-EXECUTION.html">
            
                    
                    Running ORY Oathkeeper
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../2-Concepts/0-README.html">
            
                <a href="../2-Concepts/0-README.html">
            
                    
                    Concepts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../2-Concepts/1-TERMINOLOGY.html">
            
                <a href="../2-Concepts/1-TERMINOLOGY.html">
            
                    
                    Terminology
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../2-Concepts/2-RULES.html">
            
                <a href="../2-Concepts/2-RULES.html">
            
                    
                    Rules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../3-Deyploment/0-README.html">
            
                <a href="../3-Deyploment/0-README.html">
            
                    
                    Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.4" data-path="0-README.html">
            
                <a href="0-README.html">
            
                    
                    Security
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Security</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="security">Security</h1>
<!-- toc --><div id="toc" class="toc">

<ul>
<li><a href="#stateless-authorization">Stateless Authorization</a></li>
<li><a href="#the-id-token">The ID Token</a></li>
</ul>

</div><!-- tocstop -->
<p>ORY Oathkeeper, as all ORY products, takes security extremely serious. To reduce risk, ORY Hydra issues opaque access
tokens which are impossible to decode by third parties. Internal services however often rely on stateless authorization
to process requests quickly. The next section covers how ORY Oathkeeper achieves the best of both worlds.</p>
<p>ORY Oathkeeper makes authentication and authorization data consumable to backends by transforming the original
opaque access token to a consumable ID Token (a signed JWT using the RS256 algorithm) as specified
by the OpenID Connect specification and <a href="https://www.beyondcorp.com" target="_blank">BeyondCorp</a>.</p>
<h2 id="stateless-authorization">Stateless Authorization</h2>
<p>Given an HTTP request to a resource that is protected by ORY Oathkeeper:</p>
<pre><code>GET /api/resource HTTP/1.1
Host: www.example.com
Authorization: bearer &lt;opaque-access-token&gt;
</code></pre><p>Assumed that ORY Oathkeeper is granting the access request, the <code>&lt;opaque-access-token&gt;</code> will be replaced with a
JSON Web Token that is signed using the asymmetric RS256 key:</p>
<pre><code>GET /api/resource HTTP/1.1
Host: internal-api-endpoint-dns
Authorization: bearer &lt;jwt-signed-id-token&gt;
</code></pre><p>Now, the protected resource is capable of decoding and validating the JSON Web Token using the public key supplied
by ORY Oathkeeper&apos;s API. The public key for decoding the ID token is available at Oathkeeper&apos;s <code>/.well-known/jwks.json</code> endpoint:</p>
<pre><code>http://oathkeeper:4456/.well-known/jwks.json
</code></pre><p>The endpoint returns an array of valid public keys. Every ID token is equipped with a <code>kid</code> (key id) in its header. Use
the <code>kid</code> to find the appropriate key. For now, only one public key will be returned and you can simply take the first
element of the array for key validation. We recommend using a library such as <a href="https://github.com/auth0/node-jwks-rsa" target="_blank">node-jwks-rsa</a>
for handling this appropriately.</p>
<p><img src="../images/id_token.svg" alt="ID Token Transformation"></p>
<h2 id="the-id-token">The ID Token</h2>
<p>The ID Token contains the following payload keys:</p>
<ul>
<li><code>iss</code>: Issuer Identifier for the Issuer of the response. The iss value is a case sensitive URL using the https scheme
  that contains scheme, host, and optionally, port number and path components and no query or fragment components.
  Typically, this is the URL of ORY Oathkeeper, for example: <code>https://oathkeeper.myapi.com</code>.</li>
<li><code>sub</code>: Subject Identifier. A locally unique and never reassigned identifier within the Issuer for the End-User, which
  is intended to be consumed by the Client, e.g., 24400320 or AItOawmwtWwcT0k51BayewNvutrJUqsvl6qs7A4. It must not
  exceed 255 ASCII characters in length. The sub value is a case sensitive string. The End-User might also
  be an OAuth 2.0 Client, given that the access token was granted using the OAuth 2.0 Client Credentials flow.</li>
<li><code>aud</code>: Audience(s) that this ID Token is intended for. It MUST contain the OAuth 2.0 client_id of the Relying Party
  as an audience value. It MAY also contain identifiers for other audiences. In the general case, the aud value is an
  array of case sensitive strings.</li>
<li><code>exp</code>: Expiration time on or after which the ID Token MUST NOT be accepted for processing. The processing of this
  parameter requires that the current date/time MUST be before the expiration date/time listed in the value.
  Its value is a JSON number representing the number of seconds from 1970-01-01T0:0:0Z as measured in UTC until the
  date/time. See RFC 3339 [RFC3339] for details regarding date/times in general and UTC in particular.</li>
<li><code>iat</code>: Time at which the JWT was issued. Its value is a JSON number representing the number of seconds
  from 1970-01-01T0:0:0Z as measured in UTC until the date/time.</li>
<li><code>jti</code>: A cryptographically strong random identifier to ensure the ID Token&apos;s uniqueness.</li>
<li><code>anon</code>: False if the request was granted to an anonymous user without credentials (<code>sub</code> is empty) and true otherwise.</li>
</ul>
<p>Example:</p>
<pre><code>{
  &quot;iss&quot;: &quot;https://server.example.com&quot;,
  &quot;sub&quot;: &quot;24400320&quot;,
  &quot;aud&quot;: &quot;s6BhdRkqt3&quot;,
  &quot;jti&quot;: &quot;n-0S6_WzA2Mj&quot;,
  &quot;exp&quot;: 1311281970,
  &quot;iat&quot;: 1311280970,
}
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../3-Deyploment/0-README.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Deployment">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Security","level":"1.3.4","depth":2,"previous":{"title":"Deployment","level":"1.3.3","depth":2,"path":"2-oathkeeper/3-Deyploment/0-README.md","ref":"2-oathkeeper/3-Deyploment/0-README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["edit-link","etoc","ga","sitemap-basepath","versions-ory"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"etoc":{"h2lb":2,"header":1,"maxdepth":5,"mindepth":2,"notoc":false},"versions-ory":{"type":"branches"},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sitemap-basepath":{"hostname":"https://www.ory.sh/","basePath":"/docs/guides/"},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"ga":{"configuration":"auto","token":"UA-71865250-1"},"versions":{"gitbookConfigURL":"https://raw.githubusercontent.com/ory/docs/master/guides/book.json","options":[{"value":"https://www.ory.sh/docs/guides/latest","text":"latest"},{"value":"https://www.ory.sh/docs/guides/v0.11.12","text":"0.11.12"}]},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit this page","base":"https://github.com/ory/docs/tree/master/guides"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Aeneas Rekkas","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":">=3.2.3"},"file":{"path":"2-oathkeeper/4-Security/0-README.md","mtime":"2018-05-17T09:00:37.290Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-05-17T17:11:26.052Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-etoc/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-versions-ory/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

